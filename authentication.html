<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nikolay Oskolkov, Giulia Zampirolo, Aleksandra Laura Pach">

<title>12&nbsp; Authentication – Introduction to Ancient Metagenomics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./contamination.html" rel="next">
<link href="./denovo-assembly.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-da2627e0443814779427cdd574274bae.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="12&nbsp; Authentication – Introduction to Ancient Metagenomics">
<meta property="og:description" content="">
<meta property="og:image" content="https://spaam-community.github.org/intro-to-ancient-metagenomics-book/assets/images/chapters/authentication/IGV_uneven_coverage_Y.pestis.png">
<meta property="og:site_name" content="Introduction to Ancient Metagenomics">
<meta property="og:image:height" content="408">
<meta property="og:image:width" content="1040">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./section-ancient-metagenomics.html">Ancient Metagenomics</a></li><li class="breadcrumb-item"><a href="./authentication.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Authentication</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Ancient Metagenomics</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./citing-this-book.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citing this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Authors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./foreword.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./before-you-start.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Before you Start</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./section-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-ngs-sequencing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to NGS Sequencing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-ancient-dna.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Ancient DNA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-metagenomics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Metagenomics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-microbial-genomics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Microbial Genomics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-edna.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Environmental DNA</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./section-useful-skills.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Useful Skills</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bare-bones-bash.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to the Command Line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to R and the Tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python-pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to Python and Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Introduction to Git(Hub)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./section-ancient-metagenomics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ancient Metagenomics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./taxonomic-profiling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Taxonomic Profiling, OTU Tables and Visualisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./denovo-assembly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><em>De novo</em> Genome Assembly</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./authentication.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Authentication</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./contamination.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Contamination</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./section-ancient-genomics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ancient Genomics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./genome-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Genome Mapping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./phylogenomics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Phylogenomics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./section-ancient-metagenomic-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ancient Metagenomic Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./accessing-ancient-metagenomic-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Accessing Ancient Metagenomic Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ancient-metagenomic-pipelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Ancient Metagenomic Pipelines</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./deprecated-chapters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deprecated Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functional-profiling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Functional Profiling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./appendices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter-writing-guidelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Chapter Writing Guidelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter-template.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Chapter Page Template</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Chapter Checklist</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#simulated-ancient-metagenomic-data" id="toc-simulated-ancient-metagenomic-data" class="nav-link active" data-scroll-target="#simulated-ancient-metagenomic-data"><span class="header-section-number">12.1</span> Simulated ancient metagenomic data</a></li>
  <li><a href="#genomic-hit-confirmation" id="toc-genomic-hit-confirmation" class="nav-link" data-scroll-target="#genomic-hit-confirmation"><span class="header-section-number">12.2</span> Genomic hit confirmation</a></li>
  <li><a href="#modern-genomic-hit-validation-criteria" id="toc-modern-genomic-hit-validation-criteria" class="nav-link" data-scroll-target="#modern-genomic-hit-validation-criteria"><span class="header-section-number">12.3</span> Modern genomic hit validation criteria</a>
  <ul class="collapse">
  <li><a href="#depth-vs-breadth-and-evenness-of-coverage" id="toc-depth-vs-breadth-and-evenness-of-coverage" class="nav-link" data-scroll-target="#depth-vs-breadth-and-evenness-of-coverage"><span class="header-section-number">12.3.1</span> Depth vs breadth and evenness of coverage</a></li>
  <li><a href="#breadth-of-coverage-via-krakenuniq" id="toc-breadth-of-coverage-via-krakenuniq" class="nav-link" data-scroll-target="#breadth-of-coverage-via-krakenuniq"><span class="header-section-number">12.3.2</span> Breadth of coverage via KrakenUniq</a></li>
  <li><a href="#evenness-of-coverage-via-samtools" id="toc-evenness-of-coverage-via-samtools" class="nav-link" data-scroll-target="#evenness-of-coverage-via-samtools"><span class="header-section-number">12.3.3</span> Evenness of coverage via Samtools</a></li>
  <li><a href="#alignment-quality" id="toc-alignment-quality" class="nav-link" data-scroll-target="#alignment-quality"><span class="header-section-number">12.3.4</span> Alignment quality</a></li>
  <li><a href="#affinity-to-reference" id="toc-affinity-to-reference" class="nav-link" data-scroll-target="#affinity-to-reference"><span class="header-section-number">12.3.5</span> Affinity to reference</a></li>
  </ul></li>
  <li><a href="#ancient-specific-genomic-hit-validation-criteria" id="toc-ancient-specific-genomic-hit-validation-criteria" class="nav-link" data-scroll-target="#ancient-specific-genomic-hit-validation-criteria"><span class="header-section-number">12.4</span> Ancient-specific genomic hit validation criteria</a>
  <ul class="collapse">
  <li><a href="#degradation-patterns" id="toc-degradation-patterns" class="nav-link" data-scroll-target="#degradation-patterns"><span class="header-section-number">12.4.1</span> Degradation patterns</a></li>
  </ul></li>
  <li><a href="#authentication-with-taxonomic-information" id="toc-authentication-with-taxonomic-information" class="nav-link" data-scroll-target="#authentication-with-taxonomic-information"><span class="header-section-number">12.5</span> Authentication with taxonomic information</a>
  <ul class="collapse">
  <li><a href="#taxonomic-profiling-metadmg-cpp-lca" id="toc-taxonomic-profiling-metadmg-cpp-lca" class="nav-link" data-scroll-target="#taxonomic-profiling-metadmg-cpp-lca"><span class="header-section-number">12.5.1</span> Taxonomic profiling: metaDMG-cpp lca</a></li>
  <li><a href="#deamination-patterns" id="toc-deamination-patterns" class="nav-link" data-scroll-target="#deamination-patterns"><span class="header-section-number">12.5.2</span> Deamination patterns</a></li>
  <li><a href="#ancient-metagenomic-dataset" id="toc-ancient-metagenomic-dataset" class="nav-link" data-scroll-target="#ancient-metagenomic-dataset"><span class="header-section-number">12.5.3</span> Ancient metagenomic dataset</a></li>
  <li><a href="#ancient-metagenomics-with-metadmg-cpp-the-workflow" id="toc-ancient-metagenomics-with-metadmg-cpp-the-workflow" class="nav-link" data-scroll-target="#ancient-metagenomics-with-metadmg-cpp-the-workflow"><span class="header-section-number">12.5.4</span> Ancient metagenomics with metaDMG-cpp: the workflow</a></li>
  <li><a href="#investigating-the-final-output-with-r" id="toc-investigating-the-final-output-with-r" class="nav-link" data-scroll-target="#investigating-the-final-output-with-r"><span class="header-section-number">12.5.5</span> Investigating the final output with R</a></li>
  <li><a href="#amplitude-of-damage-vs-significance" id="toc-amplitude-of-damage-vs-significance" class="nav-link" data-scroll-target="#amplitude-of-damage-vs-significance"><span class="header-section-number">12.5.6</span> Amplitude of damage vs Significance</a></li>
  <li><a href="#amplitude-of-damage-and-mean-fragment-length-through-time" id="toc-amplitude-of-damage-and-mean-fragment-length-through-time" class="nav-link" data-scroll-target="#amplitude-of-damage-and-mean-fragment-length-through-time"><span class="header-section-number">12.5.7</span> Amplitude of damage and mean fragment length through time</a></li>
  </ul></li>
  <li><a href="#optional-clean-up" id="toc-optional-clean-up" class="nav-link" data-scroll-target="#optional-clean-up"><span class="header-section-number">12.6</span> (Optional) clean-up</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">12.7</span> Summary</a></li>
  <li><a href="#acknowledgments" id="toc-acknowledgments" class="nav-link" data-scroll-target="#acknowledgments"><span class="header-section-number">12.8</span> Acknowledgments</a></li>
  <li><a href="#recommended-reading" id="toc-recommended-reading" class="nav-link" data-scroll-target="#recommended-reading"><span class="header-section-number">12.9</span> Recommended Reading</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">12.10</span> Resources</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">12.11</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./section-ancient-metagenomics.html">Ancient Metagenomics</a></li><li class="breadcrumb-item"><a href="./authentication.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Authentication</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Authentication</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nikolay Oskolkov, Giulia Zampirolo, Aleksandra Laura Pach </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled" title="Self guided: chapter environment setup">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Self guided: chapter environment setup
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>For this chapter’s exercises, if not already performed, you will need to download the chapter’s dataset, decompress the archive, and create and activate the conda environment.</p>
<p>Do this, use <code>wget</code> or right click and save to download this Zenodo archive: <a href="https://doi.org/10.5281/zenodo.13759228">10.5281/zenodo.13759228</a>, and unpack</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> xvf authentication.tar.gz </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> authentication/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can then create the subsequently activate environment with</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-f</span> authentication.yml</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate authentication</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are additional software requirements for this chapter</p>
<p>Please see the relevant chapter section in <a href="./before-you-start.html">Before you start</a> before continuing with this chapter.</p>
</div>
</div>
<p>In ancient metagenomics we typically try to answer two questions: “Who is there?” and “How ancient?”, meaning we would like to detect an organism and investigate whether this organism is ancient. There are three typical ways to identify the presence of an organism in a metagenomic sample:</p>
<ul>
<li>alignment of DNA fragments to a reference genome (<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3322381/">Bowtie</a>, <a href="https://pubmed.ncbi.nlm.nih.gov/19451168/">BWA</a>, <a href="https://www.biorxiv.org/content/10.1101/050559v1">Malt</a> etc.)</li>
<li>taxonomic (kmer-based) classification of DNA fragments (<a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1891-0">Kraken</a>, <a href="https://www.nature.com/articles/s41587-023-01688-w">MetaPhlan</a>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5131823/">Centrifuge</a> etc.)</li>
<li><em>de-novo</em> genome assembly (<a href="https://academic.oup.com/bioinformatics/article/31/10/1674/177884">Megahit</a>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5411777/">metaSPAdes</a> etc.)</li>
</ul>
<p>The first two are reference-based, i.e.&nbsp;they assume a similarity of a query ancient DNA fragment to a modern reference genome in a database. This is a strong assumption, which might not be true for very old or very diverged ancient organisms. This is the case when the reference-free <em>de-novo</em> assembly approach becomes powerful. However, <em>de-novo</em> assembly has its own computational challenges for low-coverage ancient metagenomic samples that typically contain very short DNA fragments.</p>
<p><img src="assets/images/chapters/authentication/metagenomic_approaches.png" class="img-fluid"></p>
<p>While all the three types of metagenomic analysis are suitable for exploring composition of metagenomic samples, they do not directly validate the findings or provide information about ancient or endogenous status of the detected orsganism. It can happen that the detected organism</p>
<ol type="1">
<li>was mis-identified (the DNA belongs to another organism than initially thought),</li>
<li>has a modern origin (for example, lab or sequencing contaminant)</li>
<li>is of exogenous origin (for example, an ancient microbe that entered the host <em>post-mortem</em>).</li>
</ol>
<p>Therefore, additional analysis is needed to follow-up each hit and demonstrate its ancient origin. Below, we describe a few steps that can help ancient metagenomic researchers to verify their findings and put them into biological context.</p>
<p>In this chapter, we will cover:</p>
<ul>
<li>How to recognise that a detected organism was mis-identified based on breadth / evenness of coverage</li>
<li>How to validate findings by breadth of coverage filters via k-mer based taxonomic classification with KrakenUniq</li>
<li>How to validate findings using alignments and assess mapping quality, edit distance and evenness of coverage profile</li>
<li>How to detect modern contaminants via deamination profile, DNA fragmentation and post-mortem damage (PMD) scores</li>
<li>How negative (blank) controls can help disentangle ancient organisms from modern contaminants</li>
<li>How microbial source tracking can facilitate separating endogenous and exogenous microbial communities</li>
</ul>
<p>We will also cover</p>
<ul>
<li>Introduction to combining authentication with taxonomic profiling</li>
<li>How to analyse deamination from a metagenomic dataset with metaDMG</li>
<li>How to investigate the main metaDMG statistics with R</li>
</ul>
<section id="simulated-ancient-metagenomic-data" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="simulated-ancient-metagenomic-data"><span class="header-section-number">12.1</span> Simulated ancient metagenomic data</h2>
<p>In this chapter, we will use 10 pre-simulated metagenomics with <a href="https://academic.oup.com/bioinformatics/article/33/4/577/2608651">gargammel</a> ancient metagenomic samples from <span class="citation" data-cites="Pochon2022-hj">Pochon et al. (<a href="#ref-Pochon2022-hj" role="doc-biblioref">2022</a>)</span>.<br>
</p>
<div id="fig-authenticationdecontamination-ameta" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authenticationdecontamination-ameta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/aMeta.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authenticationdecontamination-ameta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.1: Screenshot of preprint of aMeta by Pochon et al.&nbsp;2022
</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Self guided: data preparation">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Self guided: data preparation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The raw simulated data can be accessed via <a href="https://doi.org/10.17044/scilifelab.21261405">https://doi.org/10.17044/scilifelab.21261405</a></p>
<p>To download the simulated ancient metagenomic data please use the following command lines:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ameta/ <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ameta/</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://figshare.scilifelab.se/ndownloader/articles/21261405/versions/1 <span class="dt">\</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;&amp;</span> <span class="fu">unzip</span> 1 <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The DNA reads were simulated with damage, sequencing errors and Illumina adapters, therefore one will have to trim the adapters first:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$(</span><span class="fu">ls</span> <span class="pp">*</span>.fastq.gz<span class="va">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="va">sample_name</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="va">$i</span> .fastq.gz<span class="va">)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">cutadapt</span> <span class="at">-a</span> AGATCGGAAGAG <span class="at">--minimum-length</span> 30 <span class="at">-o</span> <span class="va">${sample_name}</span>.trimmed.fastq.gz <span class="va">${sample_name}</span>.fastq.gz <span class="at">-j</span> 4</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, after the basic data pre-processing has been done, we can proceed with validation, authentication and decontamination analyses.</p>
</div>
</div>
</div>
<p>In here you will see a range of directories, each representing different parts of this tutorial. One set of trimmed ‘simulated’ reads from <span class="citation" data-cites="Pochon2022-hj">Pochon et al. (<a href="#ref-Pochon2022-hj" role="doc-biblioref">2022</a>)</span> in <code>rawdata/</code>.</p>
</section>
<section id="genomic-hit-confirmation" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="genomic-hit-confirmation"><span class="header-section-number">12.2</span> Genomic hit confirmation</h2>
<p>Once an organism has been detected in a sample (via alignment, classification or <em>de-novo</em> assembly), one needs to take a closer look at multiple quality metrics in order to reliably confirm that the organism is not a false-positive detection and is of ancient origin. The methods used for this purpose can be divided into modern validation and ancient-specific validation criteria. Below, we will cover both of them.</p>
</section>
<section id="modern-genomic-hit-validation-criteria" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="modern-genomic-hit-validation-criteria"><span class="header-section-number">12.3</span> Modern genomic hit validation criteria</h2>
<p>The modern validation methods aim at confirming organism presence regardless of its ancient status. The main approaches include evenness / breadth of coverage computation, assessing alignment quality, and monitoring affinity of the DNA reads to the reference genome of the potential host.</p>
<section id="depth-vs-breadth-and-evenness-of-coverage" class="level3" data-number="12.3.1">
<h3 data-number="12.3.1" class="anchored" data-anchor-id="depth-vs-breadth-and-evenness-of-coverage"><span class="header-section-number">12.3.1</span> Depth vs breadth and evenness of coverage</h3>
<p>Concluding organism presence by relying solely on the numbers of assigned sequenced reads (aka depth of coverage metric) turns out to be not optimal and too permissive, which may result in a large amount of false-positive discoveries. For example, when using alignment to a reference genome, the mapped reads may demonstrate non-uniform coverage as visualised in the <a href="https://software.broadinstitute.org/software/igv/">Integrative Genomics Viewer (IGV)</a> below.</p>
<div id="fig-authenticationdecontamination-igv" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authenticationdecontamination-igv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/IGV_uneven_coverage_Y.pestis.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authenticationdecontamination-igv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.2: Screenshot of the IGV software. The reference genome bar is shown at the top, and in the main panel tall isolated ‘towers’ of reads with lots of coloured bases representing read ‘stacking’ i.e., un-uniform distribution of reads across the whole genome (as expected of the correct reference genome), but accumulation of all reads in the same isolated places on the reference genome, with the many variants on the reads suggesting they are from different species and aligning to conserved regions.
</figcaption>
</figure>
</div>
<p>In this case, DNA reads originating from another microbe were (mis-)aligned to <em>Yersina pestis</em> reference genome. It can be observed that a large number the reads align only to a few conserved genomic loci. Therefore, even if many thousands of DNA reads are capable of aligning to the reference genome, the overall uneven alignment pattern suggests no presence of <em>Yersina pestis</em> in the metagenomic sample. Thus, not only the number of assigned reads (proportional to depth of coverage metric) but also the <strong>breadth and evenness of coverage</strong> metrics become of particular importance for verification of metagenomic findings, i.e.&nbsp;hits with DNA reads uniformly aligned across the reference genome are more likely to be true-positive detections (<a href="#fig-authenticationdecontamination-igv" class="quarto-xref">Figure&nbsp;<span>12.3</span></a>).</p>
<div id="fig-authenticationdecontamination-igv" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authenticationdecontamination-igv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/depth_vs_breadth_of_coverage.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authenticationdecontamination-igv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.3: Schematic diagram of the differences between a) read stacking (all reads aligned at one position fo the genome), indicating you’ve not correctly identified the organism, vs b) reads distributed across all the genome. A formula at the bottom of the image shows how both A and B have the same depth of coverage even though they have very different actual patterns on the genome.
</figcaption>
</figure>
</div>
<p>In the next sections, we will show how to practically compute the breadth and evenness of coverage via KrakenUniq and Samtools.</p>
</section>
<section id="breadth-of-coverage-via-krakenuniq" class="level3" data-number="12.3.2">
<h3 data-number="12.3.2" class="anchored" data-anchor-id="breadth-of-coverage-via-krakenuniq"><span class="header-section-number">12.3.2</span> Breadth of coverage via KrakenUniq</h3>
<p>Here we are going to demonstrate that one can assess breadth of coverage information already at the taxonomic profiling step. Although taxonomic classifiers do not perform alignment, some of them, such as <a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-018-1568-0">KrakenUniq</a> and <a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1891-0">Kraken2</a> provide a way to infer breadth of coverage in addition to the number of assigned reads to a taxon. This allows for immediate filtering out a lot of false positive hits. Since Kraken-family classifiers are typically faster and <a href="https://www.biorxiv.org/content/10.1101/2022.06.01.494344v1.full.pdf">less memory-demanding</a>, i.e.&nbsp;can work with very large reference databases, compared to genome aligners, they provide a robust and fairly unbiased initial taxonomic profiling, which can still later be followed-up with proper alignment and computing evenness of coverage as described above.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Self guided: data preparation">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Self guided: data preparation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>⚠️ This step will require large amounts of memory and CPUs!, so if running yourself please note this step is better suited for a server, HPC cluster, or the cloud rather than on a laptop!</p>
<p>To profile the data with KrakenUniq one needs a database, a pre-built complete microbial NCBI RefSeq database can be accessed via <a href="https://doi.org/10.17044/scilifelab.21299541">https://doi.org/10.17044/scilifelab.21299541</a>.</p>
<p>Please use the following command line to download the database:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> krakenuniq/ <span class="co">## If you've left it...</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://figshare.scilifelab.se/ndownloader/articles/21299541/versions/1 <span class="dt">\</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&amp;&amp;</span> <span class="fu">unzip</span> 1 <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The following example command is how you would execute KrakenUniq.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$(</span><span class="fu">ls</span> <span class="pp">*</span>.trimmed.fastq.gz<span class="va">)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">krakenuniq</span> <span class="at">--db</span> KRAKENUNIQ_DB <span class="at">--fastq-input</span> <span class="va">$i</span> <span class="at">--threads</span> 20 <span class="dt">\</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>--classified-out <span class="va">${i}</span>.classified_sequences.krakenuniq <span class="dt">\</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>--unclassified-out <span class="va">${i}</span>.unclassified_sequences.krakenuniq <span class="dt">\</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>--output <span class="va">${i}</span>.sequences.krakenuniq <span class="at">--report-file</span> <span class="va">${i}</span>.krakenuniq.output</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Taxonomic k-mer-based classification of the ancient metagenomic reads can be done via KrakenUniq. However as this requires a very large database file, the results from running KrakenUniq on the 10 simulated genomes can be found in.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> krakenuniq/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>KrakenUniq by default delivers a proxy metric for breadth of coverage called the <strong>number of unique kmers</strong> (in the 4th column of its output table) assigned to a taxon. KrakenUniq output can be easily filtered with respect to both depth and breadth of coverage, which substantially reduces the number of false-positive hits.</p>
<p><img src="assets/images/chapters/authentication/krakenuniq_filter.png" class="img-fluid"></p>
<p>We can filter the KrakenUniq output with respect to both depth (<em>taxReads</em>) and breadth (<em>kmers</em>) of coverage with the following custom Python script, which selects only species with at east 200 assigned reads and 1000 unique k-mers. After the filtering, we can see a <em>Yersinia pestis</em> hit in the <em>sample 10</em> that possess the filtering thresholds with respect to both depth and breadth of coverage.</p>
<p>Run this from within the <code>krakenuniq/</code> directory.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$(</span><span class="fu">ls</span> <span class="pp">*</span>.krakenuniq.output<span class="va">)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">../scripts/filter_krakenuniq.py</span> <span class="va">$i</span> 1000 200 ../scripts/pathogensfound.very_inclusive.tab</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/images/chapters/authentication/filtered_krakenuniq_output.png" class="img-fluid"></p>
<p>We can also easily produce a KrakenUniq taxonomic abundance table <em>krakenuniq_abundance_matrix.txt</em> using the custom R script below, which takes as argument the contents of the <code>krakenuniq/</code> folder containing the KrakenUniq output files.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> ../scripts/krakenuniq_abundance_matrix.R . krakenuniq_abundance_matrix/ 1000 200</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From the <em>krakenuniq_abundance_matrix.txt</em> table inside the resulting directory, it becomes clear that <em>Yersinia pestis</em> seems to be present in a few other samples in addition to sample 10.</p>
<p><img src="assets/images/chapters/authentication/krakenuniq_abundance_matrix.png" class="img-fluid"></p>
<p>While KrakenUniq delivers information about breadth of coverage by default, you can also get this information from Kraken2.</p>
<p>For this one has to use a special flag <em>–report-minimizer-data</em> when running Kraken2 in order to get the breadth of coverage proxy which is called the <strong>number of distinct minimizers</strong> for the case of Kraken2. Below, we provide an example Kraken2 command line containing the distinct minimizer flag:</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Example only - do not run!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example only - do not run!
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="va">DBNAME</span><span class="op">=</span>Kraken2_DB_directory</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="va">KRAKEN_INPUT</span><span class="op">=</span>sample.fastq.gz</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="va">KRAKEN_OUTPUT</span><span class="op">=</span>Kraken2_output_directory</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">kraken2</span> <span class="at">--db</span> <span class="va">$DBNAME</span> <span class="at">--fastq-input</span> <span class="va">$KRAKEN_INPUT</span> <span class="at">--threads</span> 20 <span class="dt">\</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>--classified-out <span class="va">$KRAKEN_OUTPUT</span>/classified_sequences.kraken2 <span class="dt">\</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>--unclassified-out <span class="va">$KRAKEN_OUTPUT</span>/unclassified_sequences.kraken2 <span class="dt">\</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>--output <span class="va">$KRAKEN_OUTPUT</span>/sequences.kraken2 <span class="dt">\</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>--report <span class="va">$KRAKEN_OUTPUT</span>/kraken2.output <span class="dt">\</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>--use-names <span class="at">--report-minimizer-data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Then the filtering of Kraken2 output with respect to breadth and depth of coverage can be done by analogy with filtering KrakenUniq output table. In case of <em>de-novo</em> assembly, the original DNA reads are typically aligned back to the assembled contigs, and the evenness / breadth of coverage can be computed from these alignments.</p>
</section>
<section id="evenness-of-coverage-via-samtools" class="level3" data-number="12.3.3">
<h3 data-number="12.3.3" class="anchored" data-anchor-id="evenness-of-coverage-via-samtools"><span class="header-section-number">12.3.3</span> Evenness of coverage via Samtools</h3>
<p>Now, after we have detected an interesting <em>Y. pestis</em> hit, we would like to follow it up, and compute multiple quality metrics (including proper breadth and evenness of coverage) from alignments (Bowtie2 aligner will be used in our case) of the DNA reads to the <em>Y. pestis</em> reference genome. Below, we download <em>Yersinia pestis</em> reference genome from NCBI, build its Bowtie2 index, and align trimmed reads against <em>Yersinia pestis</em> reference genome with Bowtie2. Do not forget to sort and index the alignments as it will be important for computing the evenness of coverage. It is also recommended to remove multi-mapping reads, i.e.&nbsp;the ones that have MAPQ = 0, at least for Bowtie and BWA aligners that are commonly used in ancient metagenomics. Samtools with <em>-q</em> flag can be used to extract reads with MAPQ &gt; = 1.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Self guided: data preparation">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Self guided: data preparation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /<span class="op">&lt;</span>path/<span class="op">&lt;</span>to<span class="op">&gt;</span>/authentication/bowtie2</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Download reference genome</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="va">NCBI</span><span class="op">=</span>https://ftp.ncbi.nlm.nih.gov<span class="kw">;</span> <span class="va">ID</span><span class="op">=</span>GCF_000222975.1_ASM22297v1</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="va">$NCBI</span>/genomes/all/GCF/000/222/975/<span class="va">${ID}</span>/<span class="va">${ID}</span>_genomic.fna.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /<span class="op">&lt;</span>path/<span class="op">&lt;</span>to<span class="op">&gt;</span>/authentication/bowtie2</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Prepare reference genome and build Bowtie2 index</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gunzip</span> GCF_000222975.1_ASM22297v1_genomic.fna.gz<span class="kw">;</span> <span class="bu">echo</span> NC_017168.1 <span class="op">&gt;</span> region.bed</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">seqtk</span> subseq GCF_000222975.1_ASM22297v1_genomic.fna region.bed <span class="op">&gt;</span> NC_017168.1.fasta</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">bowtie2-build</span> <span class="at">--large-index</span> NC_017168.1.fasta NC_017168.1.fasta <span class="at">--threads</span> 10</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Run alignment of raw reads against FASTQ</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">bowtie2</span> <span class="at">--large-index</span> <span class="at">-x</span> NC_017168.1.fasta <span class="at">--end-to-end</span> <span class="at">--threads</span> 10 <span class="dt">\</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>--very-sensitive <span class="at">-U</span> ../rawdata/sample10.trimmed.fastq.gz <span class="kw">|</span> <span class="ex">samtools</span> view <span class="at">-bS</span> <span class="at">-h</span> <span class="at">-q</span> 1 <span class="dt">\</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>-@ 20 <span class="at">-</span> <span class="op">&gt;</span> Y.pestis_sample10.bam</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Sort and index BAM files for rapid access in downstream commands</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> sort Y.pestis_sample10.bam <span class="at">-@</span> 10 <span class="op">&gt;</span> Y.pestis_sample10.sorted.bam</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> index Y.pestis_sample10.sorted.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, the breadth / evenness of coverage can be computed from the BAM-alignments via <em>samtools depth</em> as follows:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> depth <span class="at">-a</span> Y.pestis_sample10.sorted.bam <span class="op">&gt;</span> Y.pestis_sample10.sorted.boc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and visualised using for example the following R code snippet (alternatively <a href="https://github.com/MeriamGuellil/aDNA-BAMPlotter">aDNA-BAMPlotter</a> can be used).</p>
<p>Load R by running <code>R</code> in your terminal</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note the following may take a minute or so to run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read output of samtools depth commans</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"Y.pestis_sample10.sorted.boc"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ref"</span>, <span class="st">"Pos"</span>, <span class="st">"N_reads"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split reference genome in tiles, compute breadth of coverage for each tile</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>N_tiles <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> (<span class="fu">max</span>(df<span class="sc">$</span>Pos) <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>Pos)) <span class="sc">/</span> N_tiles</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>tiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span>N_tiles) <span class="sc">*</span> step; boc <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tiles))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  df_loc <span class="ot">&lt;-</span> df[df<span class="sc">$</span>Pos <span class="sc">&gt;=</span> tiles[i] <span class="sc">&amp;</span> df<span class="sc">$</span>Pos <span class="sc">&lt;</span> tiles[i<span class="sc">+</span><span class="dv">1</span>], ]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  boc <span class="ot">&lt;-</span> <span class="fu">append</span>(boc, <span class="fu">rep</span>(<span class="fu">sum</span>(df_loc<span class="sc">$</span>N_reads <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">length</span>(df_loc<span class="sc">$</span>N_reads),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(df_loc)[<span class="dv">1</span>]))</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>boc[<span class="fu">is.na</span>(boc)]<span class="ot">&lt;-</span><span class="dv">0</span>; df<span class="sc">$</span>boc <span class="ot">&lt;-</span> boc</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>boc <span class="sc">~</span> df<span class="sc">$</span>Pos, <span class="at">type =</span> <span class="st">"s"</span>, <span class="at">xlab =</span> <span class="st">"Genome position"</span>, <span class="at">ylab =</span> <span class="st">"Coverage"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">sum</span>(df<span class="sc">$</span>N_reads <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">length</span>(df<span class="sc">$</span>N_reads)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="st">"% of genome covered"</span>), <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once finished examining the plot you can quit R</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Press 'n' when asked if you want to save your workspace image.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quit()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/images/chapters/authentication/Evenness_of_coverage.png" class="img-fluid"></p>
<p>In the R script above, we simply split the reference genome into <em>N_tiles</em> tiles and compute the breadth of coverage (number of reference nucleotides covered by at least one read normalised by the total length) locally in each tile. By visualising how the local breadth of coverage changes from tile to tile, we can monitor the distribution of the reads across the reference genome. In the evenness of coverage figure above, the reads seem to cover all parts of the reference genome uniformly, which is a good evidence of true-positive detection, even though the total mean breadth of coverage is low due to the low total number of reads.</p>
</section>
<section id="alignment-quality" class="level3" data-number="12.3.4">
<h3 data-number="12.3.4" class="anchored" data-anchor-id="alignment-quality"><span class="header-section-number">12.3.4</span> Alignment quality</h3>
<p>In addition to evenness and breadth of coverage, it is very informative to monitor how well the metagenomic reads map to a reference genome. Here one can control for <strong>mapping quality</strong> (<a href="https://samtools.github.io/hts-specs/SAMv1.pdf">MAPQ</a> field in the BAM-alignments) and the number of mismatches for each read, i.e.&nbsp;<strong>edit distance</strong>.</p>
<p>Mapping quality (MAPQ) can be extracted from the 5th column of BAM-alignments using Samtools and <em>cut</em> command in bash.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view Y.pestis_sample10.sorted.bam <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f5</span> <span class="op">&gt;</span> mapq.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then the 5th column of the filtered BAM-alignment can be visualised via a simple histogram in R as below for two random metagenomic samples.</p>
<p>Load R</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And generate the histogram with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.numeric</span>(<span class="fu">readLines</span>(<span class="st">"mapq.txt"</span>)), <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">breaks =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="assets/images/chapters/authentication/MAPQ.png" class="img-fluid"></p>
<p>Note that MAPQ scores are computed slightly differently for Bowtie and BWA, so they are not directly comparable, however, for both MAPQ ~ 10-30, as in the histograms below, indicates good affinity of the DNA reads to the reference genome. here we provide some examples of how typical MAPQ histograms for Bowtie2 and BWA alignments can look like:</p>
<p><img src="assets/images/chapters/authentication/mapq.png" class="img-fluid"></p>
<p>Edit distance can be extracted by gathering information in the NM-tag inside BAM-alignments, which reports the number of mismatches for each aligned read. This can be done either in bash / awk, or using handy functions from <em>Rsamtools</em> R package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"Rsamtools"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">ScanBamParam</span>(<span class="at">tag =</span> <span class="st">"NM"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>bam <span class="ot">&lt;-</span> <span class="fu">scanBam</span>(<span class="st">"Y.pestis_sample10.sorted.bam"</span>, <span class="at">param =</span> param)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(bam[[<span class="dv">1</span>]]<span class="sc">$</span>tag<span class="sc">$</span>NM), <span class="at">ylab=</span><span class="st">"Number of reads"</span>, <span class="at">xlab=</span><span class="st">"Number of mismatches"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once finished examining the plot you can quit R.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Press 'n' when asked if you want to save your workspace image.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quit()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/images/chapters/authentication/edit_distance.png" class="img-fluid"></p>
<p>In the barplot above we can see that the majority of reads align either without or with very few mismatches, which is an evidence of high affinity of the aligned reads with respect to the reference genome. For a true-positive finding, the edit distance barplot typically has a decreasing profile. However, for a very degraded DNA, it can have a mode around 1 or 2, which can also be reasonable. A false-positive hit would have a mode of the edit distance barplot shifted toward higher numbers of mismatches.</p>
</section>
<section id="affinity-to-reference" class="level3" data-number="12.3.5">
<h3 data-number="12.3.5" class="anchored" data-anchor-id="affinity-to-reference"><span class="header-section-number">12.3.5</span> Affinity to reference</h3>
<p>Very related to edit distance is another alignment validation metric which is called <strong>percent identity</strong>. It represents a barplot demonstrating the numbers of reads that are 100% identical to the reference genome (i.e.&nbsp;map without a single mismatch), 99% identical, 98% identical etc. Misaligned reads originating from another related organism have typically most reads with percent identity of 93-96%. In the figure below, the panels (c–e) demonstrate different percent identity distributions. In panel c, most reads show a high similarity to the reference, which indicates a correct assignment of the reads to the reference. In panel d, most reads are highly dissimilar to the reference, which suggests that they originate from different related species. In some cases, as in panel e, a mixture of correctly assigned and misassigned reads can be observed.</p>
<p><img src="assets/images/chapters/authentication/multialleleicSNPs.png" class="img-fluid"></p>
<p>Another important way to detect reads that cross-map between related species is <strong>haploidy</strong> or checking the amount of <strong>multi-allelic SNPs</strong>. Because bacteria are haploid organisms, only one allele is expected for each genomic position. Only a small number of multi-allelic sites are expected, which can result from a few mis-assigned or incorrectly aligned reads. In the figure above, panels (f–i) demonstrate histograms of SNP allele frequency distributions. Panel f demonstrates the situation when we have only a few multi-allelic sites originating from a misaligned reads. This is a preferable case scenario corresponding to correct assignment of the reads to the reference. Please also check the corresponding “Good alignments” IGV visualisation to the right in the figure above.</p>
<p>In contrast, a large number of multi-allelic sites indicates that the assigned reads originate from more than one species or strain, which can result in symmetric allele frequency distributions (e.g., if two species or strains are present in equal abundance) (panel g) or asymmetric distributions (e.g., if two species or strains are present in unequal abundance) (panel h). A large number of mis-assigned reads from closely related species can result in a large number of multi-allelic sites with low frequencies of the derived allele (panel i). The situations (g-i) correspond to incorrect assignment of the reads to the reference. Please also check the corresponding “Bad alignments” IGV visualisation to the right in the figure above.</p>
</section>
</section>
<section id="ancient-specific-genomic-hit-validation-criteria" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="ancient-specific-genomic-hit-validation-criteria"><span class="header-section-number">12.4</span> Ancient-specific genomic hit validation criteria</h2>
<p>In contrast to modern genomic hit validation criteria, the ancient-specific validation methods concentrate on DNA degradation and damage pattern as ultimate signs of ancient DNA. Below, we will discuss deamination profile, read length distribution and post mortem damage (PMD) scores metrics that provide good confirmation of ancient origin of the detected organism.</p>
<section id="degradation-patterns" class="level3" data-number="12.4.1">
<h3 data-number="12.4.1" class="anchored" data-anchor-id="degradation-patterns"><span class="header-section-number">12.4.1</span> Degradation patterns</h3>
<p>Checking evenness of coverage and alignment quality can help us to make sure that the organism we are thinking about is really present in the metagenomic sample. However, we still need to address the question “How ancinet?”. For this purpose we need to compute <strong>deamination profile</strong> and <strong>read length distribution</strong> of the aligned reads in order to prove that they demonstrate damage pattern and are sufficiently fragmented, which would be a good evidence of ancient origin of the detected organisms.</p>
<p>Deamination profile of a damaged DNA demonstrate an enrichment of C / T polymorphisms at the ends of the reads compared to all other single nucleotide substitutions. There are several tools for computing deamination profile, but perhaps the most popular is <a href="https://academic.oup.com/bioinformatics/article/29/13/1682/184965">mapDamage</a>. The tool can be run using the following command line, still in the <code>authentication/bowtie2/</code> directory:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mapDamage</span> <span class="at">-i</span> Y.pestis_sample10.sorted.bam <span class="at">-r</span> NC_017168.1.fasta <span class="at">-d</span> mapDamage_results/ <span class="at">--merge-reference-sequences</span> <span class="at">--no-stats</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/images/chapters/authentication/deamination.png" class="img-fluid"></p>
<p>maDamage delivers a bunch of useful statistics, among other read length distribution can be checked. A typical mode of DNA reads should be within a range 30-70 base-pairs in order to be a good evidence of DNA fragmentation. Reads longer tha 100 base-pairs are more likely to originate from modern contamination.</p>
<p><img src="assets/images/chapters/authentication/read_length.png" class="img-fluid"></p>
<p>Another useful tool that can be applied to assess how DNA is damaged is <a href="https://github.com/pontussk/PMDtools">PMDtools</a> which is a maximum-likelihood probabilistic model that calculates an ancient score, <strong>PMD score</strong>, for each read. The ability of PMDtools to infer ancient status with a single read resolution is quite unique and different from mapDamage that can only assess deamination based on a number of reads. PMD scores can be computed using the following command line, please note that Python2 is needed for this purpose.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-h</span> Y.pestis_sample10.bam <span class="kw">|</span> <span class="ex">pmdtools</span> <span class="at">--printDS</span> <span class="op">&gt;</span> PMDscores.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The distribution of PMD scores can be visualised via a histogram in R as follows.</p>
<p>Load R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then generate the histogram.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>pmd_scores <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"PMDscores.txt"</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pmd_scores<span class="sc">$</span>V4, <span class="at">breaks =</span> <span class="dv">1000</span>, <span class="at">xlab =</span> <span class="st">"PMDscores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once finished examining the plot you can quit R</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Press 'n' when asked if you want to save your workspace image.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quit()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/images/chapters/authentication/pmd_scores.png" class="img-fluid"></p>
<p>Typically, reads with PMD scores greater than 3 are considered to be reliably ancient, i.e.&nbsp;damaged, and can be extracted for taking a closer look. Therefore PMDtools is great for separating ancient reads from modern contaminant reads.</p>
<p>As mapDamage, PMDtools can also compute deamination profile. However, the advantage of PMDtools that it can compute deamination profile for UDG / USER treated samples (with the flag <em>–CpG</em>). For this purpose, PMDtools uses only CpG sites which escape the treatment, so deamination is not gone completely and there is a chance to authenticate treated samples. Computing deamination pattern with PMDtools can be achieved with the following command line (please note that the scripts <em>pmdtools.0.60.py</em> and <em>plotPMD.v2.R</em> can be downloaded from the github repository here https://github.com/pontussk/PMDtools):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view Y.pestis_sample10.bam <span class="kw">|</span> <span class="ex">pmdtools</span> <span class="at">--platypus</span> <span class="op">&gt;</span> PMD_temp.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can then run simple R commands directly from the terminal (without loading R itself with) the following.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> CMD BATCH plotPMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/images/chapters/authentication/PMD_Skoglund_et_al_2015_Current_Biology.png" class="img-fluid"></p>
<p>When performing ancient status analysis on <strong>de-novo</strong> assembled contigs, it can be computationally challenging and time consuming to run mapDamage or PMDtools on all of them as there can be hundreds of thousands contigs. In addition, the outputs from mapDamage and PMDtools lacking a clear numeric quantity or a statistical test that could provide an “ancient vs.&nbsp;non-ancient” decision for each <strong>de-novo</strong> assembled contig. To address these limitations, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8323603/pdf/peerj-09-11845.pdf">pyDamage</a> tool was recently developed. PyDamage evaluates the amount of aDNA damage and tests the hypothesis whether a model assuming presence of aDNA damage better explains the data than a null model.</p>
<p><img src="assets/images/chapters/authentication/pyDamage.png" class="img-fluid"></p>
<p>pyDamage can be run on a sorted BAM-alignments of the microbial reads to the <strong>de-novo</strong> assembled contigs using the following command line:</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Example command - do not run!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example command - do not run!
</div>
</div>
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pydamage</span> analyze <span class="at">-w</span> 30 <span class="at">-p</span> 14 filtered.sorted.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="authentication-with-taxonomic-information" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="authentication-with-taxonomic-information"><span class="header-section-number">12.5</span> Authentication with taxonomic information</h2>
<p>Different tools can be utilised to assess the level of deamination at the strand termini and the most popular are mapDamage2.0 (<a href="https://academic.oup.com/bioinformatics/article/29/13/1682/184965">https://academic.oup.com/bioinformatics/article/29/13/1682/184965</a>) and PMDtools (<a href="https://github.com/pontussk/PMDtools">https://github.com/pontussk/PMDtools</a>).</p>
<p>However, applying these to a metagenomic dataset can be computationally demanding and time-consuming due to the tens of thousands of different taxonomic entities it can include.</p>
<p><strong>metaDMG</strong> is currently under development and it represents a fast, flexible, and efficient tool for performing <strong>taxonomic profiling</strong> (with the integrated ngsLCA algorithm) and quantifying <strong>post-mortem DNA damage</strong>. It is specially optimised for ancient metagenomic datasets where raw fastq files have been mapped against large sets of reference genomes. metaDMG should be run on a read coordinate sorted BAM/SAM-alignment file and can calculate the degree of damage from read data mapped against single and multiple genomes by analysing mismatches and deletions contained in the MD:Z tag of the input alignment file. This reference-free approach allows for a faster processing of the deamination patterns (<a href="#fig-authentication-fig1" class="quarto-xref">Figure&nbsp;<span>12.4</span></a>).</p>
<div id="fig-authentication-fig1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/Fig_9_deamination.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.4: Damage plots of reads assigned to Homo sapiens with post-mortem damage pattern increasing at read termini [from metagenomic samples, adapted from <span class="citation" data-cites="Michelsen2022">(<a href="#ref-Michelsen2022" role="doc-biblioref">Michelsen et al. 2022</a>)</span>]. The figure shows the damage rate f (x) = k(x)∕N(x) as a function of position x for both forward (C→T) and reverse (G→A).
</figcaption>
</figure>
</div>
<p>In particular, three different settings can be run:</p>
<ol type="1">
<li><p>Single genome analysis with one overall global estimate of the damage patterns. Similar to mapDamage2.0 (<a href="https://academic.oup.com/bioinformatics/article/29/13/1682/184965">https://academic.oup.com/bioinformatics/article/29/13/1682/184965</a>).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Example, do not run</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> getdamage <span class="at">--run_mode</span> 0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Metagenomic (e.g.&nbsp;multiple genome alignments) analyses. This mode provides a damage estimate per reference, taxonomic name or accession number, including all alignments without any taxonomical classification</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Example, do not run</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> getdamage <span class="at">--run_mode</span> 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Metagenomic analyses with the integration of the taxonomy: Least Common Ancestor algorithm (<code>ngsLCA</code>). This allows the computation of damage estimates for alignments classified to given taxonomic levels.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Example, do not run</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> lca</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<p>In this section we will utilise <code>metaDMG-cpp lca</code> since we are interested in a more comprehensive analysis that includes the taxonomic classification of our alignments. For those interested in exploring other functionalities of metaDMG, I encourage you to visit the tool’s official GitHub (<a href="https://github.com/metaDMG-dev/metaDMG-cpp">https://github.com/metaDMG-dev/metaDMG-cpp</a>) and the ngsLCA official GitHub (<a href="https://github.com/miwipe/ngsLCA">https://github.com/miwipe/ngsLCA</a>).</p>
<section id="taxonomic-profiling-metadmg-cpp-lca" class="level3" data-number="12.5.1">
<h3 data-number="12.5.1" class="anchored" data-anchor-id="taxonomic-profiling-metadmg-cpp-lca"><span class="header-section-number">12.5.1</span> Taxonomic profiling: metaDMG-cpp lca</h3>
<p>The <code>metaDMG-cpp lca</code> function is based on the <code>ngsLCA</code> (next-generation sequence Lowest Common Ancestor) algorithm to collect mismatch information for all reads and generate a taxonomic profile <span class="citation" data-cites="Wang2022-fr">(<a href="#ref-Wang2022-fr" role="doc-biblioref">Wang et al. 2022</a>)</span>. It counts substitutions between read and reference on internal nodes within a taxonomy (e.g.&nbsp;species, genus and family level). It is built upon the NCBI taxonomy (<a href="https://www.ncbi.nlm.nih.gov/taxonomy">https://www.ncbi.nlm.nih.gov/taxonomy</a>) and requires three files:</p>
<ul>
<li><strong>nodes.dmp</strong>: taxonomic nodes and the relationships between different taxa in the tree</li>
<li><strong>access2taxID</strong>: the “taxonomy file”, sequence accession numbers, and the corresponding taxonomic IDs.</li>
<li><strong>names.dmp</strong>: scientific names of the taxa are associated with each taxon contained in nodes.dmp file.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For custom reference genomes not covered by NCBI, their accession IDs and the corresponded NCBI taxonomic IDs need to be manually attached to the NCBI access2taxID file.</p>
</div>
</div>
<p>The <code>ngsLCA</code> program considers a chosen similarity interval between each read and its reference in the generated bam/sam file. The similarity can be set as an edit distance <code>[-editdist[min/max]]</code>, i.e., number of mismatches between the read to reference genome, or as a similarity distance <code>[-simscore[low/high]]</code>, i.e., percentage of mismatches between the read to reference genome.</p>
<p>The main files produced by this command have the extensions <code>.bdamage.gz</code>, <code>lca.gz</code> and ‘stat.gz’. The first consists of a nucleotide misincorporation matrix (also called <strong>mismatch matrix</strong>) which represents the nucleotide substitution counts across the reads (<a href="#tbl-authentication-examplecodetable2" class="quarto-xref">Table&nbsp;<span>12.1</span></a>). The lca file reports the sequences analysed and their taxonomic paths, while the stat file includes other statistics (gc content, fragment length).</p>
<p>We report an example of the bdamage.gz file output printed using the command <code>metaDMG-cpp print</code>:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Example, do not run</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> print file.bdamage.gz <span class="at">-names</span> names.dmp <span class="op">&gt;</span> bdamage_table.tsv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-authentication-examplecodetable2" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="top">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-authentication-examplecodetable2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12.1: Table 1. Example of the bdamage.gz mismatch matrix table for beech (Fagus sylvatica) of sample VM-14 provided in the exercise.
</figcaption>
<div aria-describedby="tbl-authentication-examplecodetable2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="hvrwoxltag" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:scroll;overflow-y:auto;width:auto;height:auto;">
<style>#hvrwoxltag table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hvrwoxltag thead, #hvrwoxltag tbody, #hvrwoxltag tfoot, #hvrwoxltag tr, #hvrwoxltag td, #hvrwoxltag th {
  border-style: none;
}

#hvrwoxltag p {
  margin: 0;
  padding: 0;
}

#hvrwoxltag .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hvrwoxltag .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hvrwoxltag .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hvrwoxltag .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hvrwoxltag .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hvrwoxltag .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hvrwoxltag .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hvrwoxltag .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hvrwoxltag .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hvrwoxltag .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hvrwoxltag .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hvrwoxltag .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hvrwoxltag .gt_spanner_row {
  border-bottom-style: hidden;
}

#hvrwoxltag .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hvrwoxltag .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hvrwoxltag .gt_from_md > :first-child {
  margin-top: 0;
}

#hvrwoxltag .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hvrwoxltag .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hvrwoxltag .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hvrwoxltag .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hvrwoxltag .gt_row_group_first td {
  border-top-width: 2px;
}

#hvrwoxltag .gt_row_group_first th {
  border-top-width: 2px;
}

#hvrwoxltag .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvrwoxltag .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hvrwoxltag .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hvrwoxltag .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hvrwoxltag .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvrwoxltag .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hvrwoxltag .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hvrwoxltag .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hvrwoxltag .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hvrwoxltag .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hvrwoxltag .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvrwoxltag .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hvrwoxltag .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hvrwoxltag .gt_left {
  text-align: left;
}

#hvrwoxltag .gt_center {
  text-align: center;
}

#hvrwoxltag .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hvrwoxltag .gt_font_normal {
  font-weight: normal;
}

#hvrwoxltag .gt_font_bold {
  font-weight: bold;
}

#hvrwoxltag .gt_font_italic {
  font-style: italic;
}

#hvrwoxltag .gt_super {
  font-size: 65%;
}

#hvrwoxltag .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hvrwoxltag .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hvrwoxltag .gt_indent_1 {
  text-indent: 5px;
}

#hvrwoxltag .gt_indent_2 {
  text-indent: 10px;
}

#hvrwoxltag .gt_indent_3 {
  text-indent: 15px;
}

#hvrwoxltag .gt_indent_4 {
  text-indent: 20px;
}

#hvrwoxltag .gt_indent_5 {
  text-indent: 25px;
}

#hvrwoxltag .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hvrwoxltag div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="20" class="gt_heading gt_title gt_font_normal gt_bottom_border">Table 1. Example of the bdamage.gz mismatch matrix table for beech (<em>Fagus sylvatica</em>) of sample VM-14 provided in the exercise.</th>
</tr>
<tr class="gt_col_headings even">
<th id="FunkyName" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">FunkyName</th>
<th id="Nalignments" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Nalignments</th>
<th id="Direction" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Direction</th>
<th id="Pos" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Pos</th>
<th id="AA" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AA</th>
<th id="AC" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AC</th>
<th id="AG" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AG</th>
<th id="AT" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">AT</th>
<th id="CA" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">CA</th>
<th id="CC" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">CC</th>
<th id="CG" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">CG</th>
<th id="CT" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">CT</th>
<th id="GA" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">GA</th>
<th id="GC" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">GC</th>
<th id="GG" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">GG</th>
<th id="GT" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">GT</th>
<th id="TA" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">TA</th>
<th id="TC" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">TC</th>
<th id="TG" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">TG</th>
<th id="TT" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">TT</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">0</td>
<td class="gt_row gt_right" headers="AA">0.989742</td>
<td class="gt_row gt_right" headers="AC">0.002790</td>
<td class="gt_row gt_right" headers="AG">0.006384</td>
<td class="gt_row gt_right" headers="AT">0.001085</td>
<td class="gt_row gt_right" headers="CA">0.001337</td>
<td class="gt_row gt_right" headers="CC">0.901014</td>
<td class="gt_row gt_right" headers="CG">0.003230</td>
<td class="gt_row gt_right" headers="CT">0.094419</td>
<td class="gt_row gt_right" headers="GA">0.029968</td>
<td class="gt_row gt_right" headers="GC">0.004090</td>
<td class="gt_row gt_right" headers="GG">0.963388</td>
<td class="gt_row gt_right" headers="GT">0.002554</td>
<td class="gt_row gt_right" headers="TA">0.003400</td>
<td class="gt_row gt_right" headers="TC">0.013838</td>
<td class="gt_row gt_right" headers="TG">0.001919</td>
<td class="gt_row gt_right" headers="TT">0.980843</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">1</td>
<td class="gt_row gt_right" headers="AA">0.989488</td>
<td class="gt_row gt_right" headers="AC">0.003044</td>
<td class="gt_row gt_right" headers="AG">0.004779</td>
<td class="gt_row gt_right" headers="AT">0.002689</td>
<td class="gt_row gt_right" headers="CA">0.000085</td>
<td class="gt_row gt_right" headers="CC">0.943479</td>
<td class="gt_row gt_right" headers="CG">0.005200</td>
<td class="gt_row gt_right" headers="CT">0.051235</td>
<td class="gt_row gt_right" headers="GA">0.018523</td>
<td class="gt_row gt_right" headers="GC">0.004122</td>
<td class="gt_row gt_right" headers="GG">0.974800</td>
<td class="gt_row gt_right" headers="GT">0.002556</td>
<td class="gt_row gt_right" headers="TA">0.002407</td>
<td class="gt_row gt_right" headers="TC">0.008830</td>
<td class="gt_row gt_right" headers="TG">0.000764</td>
<td class="gt_row gt_right" headers="TT">0.987998</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">2</td>
<td class="gt_row gt_right" headers="AA">0.993037</td>
<td class="gt_row gt_right" headers="AC">0.000288</td>
<td class="gt_row gt_right" headers="AG">0.005555</td>
<td class="gt_row gt_right" headers="AT">0.001121</td>
<td class="gt_row gt_right" headers="CA">0.003679</td>
<td class="gt_row gt_right" headers="CC">0.980400</td>
<td class="gt_row gt_right" headers="CG">0.000069</td>
<td class="gt_row gt_right" headers="CT">0.015852</td>
<td class="gt_row gt_right" headers="GA">0.016200</td>
<td class="gt_row gt_right" headers="GC">0.002869</td>
<td class="gt_row gt_right" headers="GG">0.975140</td>
<td class="gt_row gt_right" headers="GT">0.005790</td>
<td class="gt_row gt_right" headers="TA">0.005933</td>
<td class="gt_row gt_right" headers="TC">0.014151</td>
<td class="gt_row gt_right" headers="TG">0.004898</td>
<td class="gt_row gt_right" headers="TT">0.975018</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">3</td>
<td class="gt_row gt_right" headers="AA">0.981054</td>
<td class="gt_row gt_right" headers="AC">0.005307</td>
<td class="gt_row gt_right" headers="AG">0.009159</td>
<td class="gt_row gt_right" headers="AT">0.004480</td>
<td class="gt_row gt_right" headers="CA">0.004385</td>
<td class="gt_row gt_right" headers="CC">0.978382</td>
<td class="gt_row gt_right" headers="CG">0.000910</td>
<td class="gt_row gt_right" headers="CT">0.016323</td>
<td class="gt_row gt_right" headers="GA">0.017552</td>
<td class="gt_row gt_right" headers="GC">0.005319</td>
<td class="gt_row gt_right" headers="GG">0.971735</td>
<td class="gt_row gt_right" headers="GT">0.005394</td>
<td class="gt_row gt_right" headers="TA">0.003053</td>
<td class="gt_row gt_right" headers="TC">0.006302</td>
<td class="gt_row gt_right" headers="TG">0.000173</td>
<td class="gt_row gt_right" headers="TT">0.990472</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">4</td>
<td class="gt_row gt_right" headers="AA">0.994413</td>
<td class="gt_row gt_right" headers="AC">0.000076</td>
<td class="gt_row gt_right" headers="AG">0.005455</td>
<td class="gt_row gt_right" headers="AT">0.000056</td>
<td class="gt_row gt_right" headers="CA">0.000403</td>
<td class="gt_row gt_right" headers="CC">0.971447</td>
<td class="gt_row gt_right" headers="CG">0.003505</td>
<td class="gt_row gt_right" headers="CT">0.024645</td>
<td class="gt_row gt_right" headers="GA">0.007117</td>
<td class="gt_row gt_right" headers="GC">0.002939</td>
<td class="gt_row gt_right" headers="GG">0.989472</td>
<td class="gt_row gt_right" headers="GT">0.000472</td>
<td class="gt_row gt_right" headers="TA">0.000247</td>
<td class="gt_row gt_right" headers="TC">0.008299</td>
<td class="gt_row gt_right" headers="TG">0.000152</td>
<td class="gt_row gt_right" headers="TT">0.991301</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">5</td>
<td class="gt_row gt_right" headers="AA">0.988985</td>
<td class="gt_row gt_right" headers="AC">0.000061</td>
<td class="gt_row gt_right" headers="AG">0.009803</td>
<td class="gt_row gt_right" headers="AT">0.001151</td>
<td class="gt_row gt_right" headers="CA">0.000032</td>
<td class="gt_row gt_right" headers="CC">0.977904</td>
<td class="gt_row gt_right" headers="CG">0.005916</td>
<td class="gt_row gt_right" headers="CT">0.016148</td>
<td class="gt_row gt_right" headers="GA">0.025535</td>
<td class="gt_row gt_right" headers="GC">0.000138</td>
<td class="gt_row gt_right" headers="GG">0.974234</td>
<td class="gt_row gt_right" headers="GT">0.000094</td>
<td class="gt_row gt_right" headers="TA">0.001613</td>
<td class="gt_row gt_right" headers="TC">0.009086</td>
<td class="gt_row gt_right" headers="TG">0.000482</td>
<td class="gt_row gt_right" headers="TT">0.988820</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">6</td>
<td class="gt_row gt_right" headers="AA">0.989806</td>
<td class="gt_row gt_right" headers="AC">0.000239</td>
<td class="gt_row gt_right" headers="AG">0.004127</td>
<td class="gt_row gt_right" headers="AT">0.005828</td>
<td class="gt_row gt_right" headers="CA">0.003278</td>
<td class="gt_row gt_right" headers="CC">0.975862</td>
<td class="gt_row gt_right" headers="CG">0.002776</td>
<td class="gt_row gt_right" headers="CT">0.018084</td>
<td class="gt_row gt_right" headers="GA">0.015836</td>
<td class="gt_row gt_right" headers="GC">0.004876</td>
<td class="gt_row gt_right" headers="GG">0.977987</td>
<td class="gt_row gt_right" headers="GT">0.001301</td>
<td class="gt_row gt_right" headers="TA">0.000418</td>
<td class="gt_row gt_right" headers="TC">0.015145</td>
<td class="gt_row gt_right" headers="TG">0.002972</td>
<td class="gt_row gt_right" headers="TT">0.981465</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">7</td>
<td class="gt_row gt_right" headers="AA">0.987598</td>
<td class="gt_row gt_right" headers="AC">0.007473</td>
<td class="gt_row gt_right" headers="AG">0.004898</td>
<td class="gt_row gt_right" headers="AT">0.000031</td>
<td class="gt_row gt_right" headers="CA">0.009555</td>
<td class="gt_row gt_right" headers="CC">0.974281</td>
<td class="gt_row gt_right" headers="CG">0.002914</td>
<td class="gt_row gt_right" headers="CT">0.013250</td>
<td class="gt_row gt_right" headers="GA">0.015450</td>
<td class="gt_row gt_right" headers="GC">0.000015</td>
<td class="gt_row gt_right" headers="GG">0.978637</td>
<td class="gt_row gt_right" headers="GT">0.005898</td>
<td class="gt_row gt_right" headers="TA">0.002356</td>
<td class="gt_row gt_right" headers="TC">0.005547</td>
<td class="gt_row gt_right" headers="TG">0.000231</td>
<td class="gt_row gt_right" headers="TT">0.991865</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">8</td>
<td class="gt_row gt_right" headers="AA">0.983646</td>
<td class="gt_row gt_right" headers="AC">0.001314</td>
<td class="gt_row gt_right" headers="AG">0.013659</td>
<td class="gt_row gt_right" headers="AT">0.001380</td>
<td class="gt_row gt_right" headers="CA">0.001187</td>
<td class="gt_row gt_right" headers="CC">0.971496</td>
<td class="gt_row gt_right" headers="CG">0.000207</td>
<td class="gt_row gt_right" headers="CT">0.027110</td>
<td class="gt_row gt_right" headers="GA">0.011010</td>
<td class="gt_row gt_right" headers="GC">0.003486</td>
<td class="gt_row gt_right" headers="GG">0.985432</td>
<td class="gt_row gt_right" headers="GT">0.000072</td>
<td class="gt_row gt_right" headers="TA">0.000006</td>
<td class="gt_row gt_right" headers="TC">0.007790</td>
<td class="gt_row gt_right" headers="TG">0.001605</td>
<td class="gt_row gt_right" headers="TT">0.990598</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">9</td>
<td class="gt_row gt_right" headers="AA">0.995312</td>
<td class="gt_row gt_right" headers="AC">0.000119</td>
<td class="gt_row gt_right" headers="AG">0.003117</td>
<td class="gt_row gt_right" headers="AT">0.001452</td>
<td class="gt_row gt_right" headers="CA">0.001707</td>
<td class="gt_row gt_right" headers="CC">0.982706</td>
<td class="gt_row gt_right" headers="CG">0.002370</td>
<td class="gt_row gt_right" headers="CT">0.013217</td>
<td class="gt_row gt_right" headers="GA">0.018666</td>
<td class="gt_row gt_right" headers="GC">0.003942</td>
<td class="gt_row gt_right" headers="GG">0.972469</td>
<td class="gt_row gt_right" headers="GT">0.004922</td>
<td class="gt_row gt_right" headers="TA">0.004357</td>
<td class="gt_row gt_right" headers="TC">0.002576</td>
<td class="gt_row gt_right" headers="TG">0.002286</td>
<td class="gt_row gt_right" headers="TT">0.990781</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">10</td>
<td class="gt_row gt_right" headers="AA">0.991643</td>
<td class="gt_row gt_right" headers="AC">0.003135</td>
<td class="gt_row gt_right" headers="AG">0.004654</td>
<td class="gt_row gt_right" headers="AT">0.000568</td>
<td class="gt_row gt_right" headers="CA">0.000132</td>
<td class="gt_row gt_right" headers="CC">0.980449</td>
<td class="gt_row gt_right" headers="CG">0.000000</td>
<td class="gt_row gt_right" headers="CT">0.019419</td>
<td class="gt_row gt_right" headers="GA">0.015322</td>
<td class="gt_row gt_right" headers="GC">0.002766</td>
<td class="gt_row gt_right" headers="GG">0.979047</td>
<td class="gt_row gt_right" headers="GT">0.002864</td>
<td class="gt_row gt_right" headers="TA">0.000164</td>
<td class="gt_row gt_right" headers="TC">0.010653</td>
<td class="gt_row gt_right" headers="TG">0.000005</td>
<td class="gt_row gt_right" headers="TT">0.989178</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">11</td>
<td class="gt_row gt_right" headers="AA">0.992977</td>
<td class="gt_row gt_right" headers="AC">0.002227</td>
<td class="gt_row gt_right" headers="AG">0.004369</td>
<td class="gt_row gt_right" headers="AT">0.000427</td>
<td class="gt_row gt_right" headers="CA">0.000010</td>
<td class="gt_row gt_right" headers="CC">0.978681</td>
<td class="gt_row gt_right" headers="CG">0.000303</td>
<td class="gt_row gt_right" headers="CT">0.021006</td>
<td class="gt_row gt_right" headers="GA">0.019069</td>
<td class="gt_row gt_right" headers="GC">0.003154</td>
<td class="gt_row gt_right" headers="GG">0.976644</td>
<td class="gt_row gt_right" headers="GT">0.001134</td>
<td class="gt_row gt_right" headers="TA">0.003626</td>
<td class="gt_row gt_right" headers="TC">0.003529</td>
<td class="gt_row gt_right" headers="TG">0.002571</td>
<td class="gt_row gt_right" headers="TT">0.990274</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">12</td>
<td class="gt_row gt_right" headers="AA">0.986903</td>
<td class="gt_row gt_right" headers="AC">0.002606</td>
<td class="gt_row gt_right" headers="AG">0.006447</td>
<td class="gt_row gt_right" headers="AT">0.004044</td>
<td class="gt_row gt_right" headers="CA">0.008512</td>
<td class="gt_row gt_right" headers="CC">0.972589</td>
<td class="gt_row gt_right" headers="CG">0.000003</td>
<td class="gt_row gt_right" headers="CT">0.018896</td>
<td class="gt_row gt_right" headers="GA">0.003895</td>
<td class="gt_row gt_right" headers="GC">0.002801</td>
<td class="gt_row gt_right" headers="GG">0.992522</td>
<td class="gt_row gt_right" headers="GT">0.000781</td>
<td class="gt_row gt_right" headers="TA">0.002139</td>
<td class="gt_row gt_right" headers="TC">0.008530</td>
<td class="gt_row gt_right" headers="TG">0.000036</td>
<td class="gt_row gt_right" headers="TT">0.989295</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">13</td>
<td class="gt_row gt_right" headers="AA">0.991904</td>
<td class="gt_row gt_right" headers="AC">0.001482</td>
<td class="gt_row gt_right" headers="AG">0.001852</td>
<td class="gt_row gt_right" headers="AT">0.004761</td>
<td class="gt_row gt_right" headers="CA">0.005883</td>
<td class="gt_row gt_right" headers="CC">0.971748</td>
<td class="gt_row gt_right" headers="CG">0.000493</td>
<td class="gt_row gt_right" headers="CT">0.021876</td>
<td class="gt_row gt_right" headers="GA">0.021197</td>
<td class="gt_row gt_right" headers="GC">0.000126</td>
<td class="gt_row gt_right" headers="GG">0.978637</td>
<td class="gt_row gt_right" headers="GT">0.000040</td>
<td class="gt_row gt_right" headers="TA">0.000438</td>
<td class="gt_row gt_right" headers="TC">0.003696</td>
<td class="gt_row gt_right" headers="TG">0.000058</td>
<td class="gt_row gt_right" headers="TT">0.995809</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">14</td>
<td class="gt_row gt_right" headers="AA">0.990775</td>
<td class="gt_row gt_right" headers="AC">0.000005</td>
<td class="gt_row gt_right" headers="AG">0.009060</td>
<td class="gt_row gt_right" headers="AT">0.000159</td>
<td class="gt_row gt_right" headers="CA">0.002901</td>
<td class="gt_row gt_right" headers="CC">0.976768</td>
<td class="gt_row gt_right" headers="CG">0.000280</td>
<td class="gt_row gt_right" headers="CT">0.020051</td>
<td class="gt_row gt_right" headers="GA">0.013583</td>
<td class="gt_row gt_right" headers="GC">0.000690</td>
<td class="gt_row gt_right" headers="GG">0.980013</td>
<td class="gt_row gt_right" headers="GT">0.005714</td>
<td class="gt_row gt_right" headers="TA">0.000930</td>
<td class="gt_row gt_right" headers="TC">0.006973</td>
<td class="gt_row gt_right" headers="TG">0.000307</td>
<td class="gt_row gt_right" headers="TT">0.991789</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="FunkyName">Fagus sylvatica</td>
<td class="gt_row gt_right" headers="Nalignments">196960</td>
<td class="gt_row gt_right" headers="Direction">5'</td>
<td class="gt_row gt_right" headers="Pos">15</td>
<td class="gt_row gt_right" headers="AA">0.988845</td>
<td class="gt_row gt_right" headers="AC">0.002256</td>
<td class="gt_row gt_right" headers="AG">0.004008</td>
<td class="gt_row gt_right" headers="AT">0.004892</td>
<td class="gt_row gt_right" headers="CA">0.013058</td>
<td class="gt_row gt_right" headers="CC">0.960680</td>
<td class="gt_row gt_right" headers="CG">0.000246</td>
<td class="gt_row gt_right" headers="CT">0.026015</td>
<td class="gt_row gt_right" headers="GA">0.016849</td>
<td class="gt_row gt_right" headers="GC">0.000012</td>
<td class="gt_row gt_right" headers="GG">0.982107</td>
<td class="gt_row gt_right" headers="GT">0.001032</td>
<td class="gt_row gt_right" headers="TA">0.003212</td>
<td class="gt_row gt_right" headers="TC">0.008099</td>
<td class="gt_row gt_right" headers="TG">0.000052</td>
<td class="gt_row gt_right" headers="TT">0.988638</td>
</tr>
</tbody>
</table>

</div>
</div>
</figure>
</div>
</section>
<section id="deamination-patterns" class="level3" data-number="12.5.2">
<h3 data-number="12.5.2" class="anchored" data-anchor-id="deamination-patterns"><span class="header-section-number">12.5.2</span> Deamination patterns</h3>
<p><strong>metaDMG</strong> can perform a numerical optimisation of the deamination frequencies (C→T, G→A) using the binomial or beta-binomial likelihood models, where the latter can deal with a large amount of variance (overdispersion). This function is called the <code>metaDMG-cpp dfit</code> or damage estimates function.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Example, do not run</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>metaDMG-cpp dfit</code> allows us to estimate the four fit parameters of the damage model (<a href="#fig-authentication-fig2" class="quarto-xref">Figure&nbsp;<span>12.5</span></a>):</p>
<ul>
<li><strong>A</strong>: the amplitude of damage on position one;</li>
<li><strong>q</strong>: the constant deamination background;</li>
<li><strong>c</strong>: relative decrease of damage per position;</li>
<li><strong>ϕ</strong>: the uncertainty of the likelihood model used (binomial or beta-binomial).</li>
</ul>
<p>Another important parameter is the <strong>Zfit</strong> or significance, which represents the number of standard deviations (“sigmas”) away from zero, or in other words, the certainty of the damage being positive.</p>
<div id="fig-authentication-fig2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/F1._MichelsenB.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.5: The damage model. The figure shows the misincorporations as circles and the damage as a solid line. The fit parameters are reported: A,c,q,ϕ. The uncertainty for a binomial model is in dark grey, while the uncertainty for a beta-binomial model is in light grey <span class="citation" data-cites="Michelsen2022">(from <a href="#ref-Michelsen2022" role="doc-biblioref">Michelsen et al. 2022</a>)</span>
</figcaption>
</figure>
</div>
<p>Accurate damage estimates are crucial for the authentication of the metagenomic dataset. The <em>number of reads</em> and the <em>significance (Zfit)</em> are additional parameters that can impact the accuracy and reliability of ancient DNA analysis.</p>
<p>Tests on a single-genome have shown how the accuracy of metaDMG dfit increases depending on the number of reads (<a href="#fig-authentication-fig3" class="quarto-xref">Figure&nbsp;<span>12.6</span></a>).</p>
<div id="fig-authentication-fig3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/F3_Michelsen.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.6: The single-genome simulations on the <em>Homo Sapiens</em> genome with a mean fragment length of 60 and 10% damage. The known damage (Dknown) is shown as a dashed line. A. Estimated damage and its standard deviation (error bars) for 20 replicates (100 reads each). B. Average damage as a function of the number of reads (with the average of the standard deviations as errors) <span class="citation" data-cites="Michelsen2022">(Adapted from <a href="#ref-Michelsen2022" role="doc-biblioref">Michelsen et al. 2022</a>)</span>.
</figcaption>
</figure>
</div>
<p>The simulation on the <em>Homo Sapiens</em> genome, illustrated in <a href="#fig-authentication-fig3" class="quarto-xref">Figure&nbsp;<span>12.6</span></a> demonstrates the individual metaDMG damage estimates for 20 selected replications (iterations 60 to 79). When damage estimates are minimal, the distribution of Dfit is limited to positive values. This limitation can result in error bars extending into negative damage values, thus producing unrealistic estimates. As shown in <a href="#fig-authentication-fig3" class="quarto-xref">Figure&nbsp;<span>12.6</span></a>, the damage tends to converge towards the known values as the number of reads increases.</p>
<p>In addition, the simulation reports a relationship between the amount of damage in taxa and the number of reads (<a href="#fig-authentication-fig4" class="quarto-xref">Figure&nbsp;<span>12.7</span></a>). As shown in <a href="#fig-authentication-fig4" class="quarto-xref">Figure&nbsp;<span>12.7</span></a>, low expected damage (~5 %) requires about 1000 reads to be 95% certain about its estimation, while higher levels of damage (~15-30%) require fewer reads (100-500) to reach the same level of certainty. When increasing the significance threshold (Zfit) more reads are also required.</p>
<div id="fig-authentication-fig4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/F4_Michelsen.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.7: Relationship between the damage and the number of reads for the simulated single-genome data. The lines represent the number of reads needed to correctly infer the amount of damage: the solid line shows a certainty of 95%, and the dashed line, a certainty of 50%. Colors represent the significance (Zfit) cuts at 2 (blue), 3 (red), and 4 (green). <span class="citation" data-cites="Michelsen2022">(from <a href="#ref-Michelsen2022" role="doc-biblioref">Michelsen et al. 2022</a>)</span>
</figcaption>
</figure>
</div>
<p>Simulations using metagenomic datasets have also evaluated the relationship between the amount of damage and its significance (<a href="#fig-authentication-fig5" class="quarto-xref">Figure&nbsp;<span>12.8</span></a>).</p>
<div id="fig-authentication-fig5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/F5._Michelsen.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.8: The amount of damage as a function of significance (metagenomic simulations). A. damage of the ancient taxa; B. damage of the non-ancient taxa. A larger dot size indicates a higher number of reads. <span class="citation" data-cites="Michelsen2022">(Adapted from <a href="#ref-Michelsen2022" role="doc-biblioref">Michelsen et al. 2022</a>)</span>
</figcaption>
</figure>
</div>
<p>As shown in <a href="#fig-authentication-fig5" class="quarto-xref">Figure&nbsp;<span>12.8</span></a>, there is a difference in the damage estimates between the ancient and the non-ancient taxa of simulated metagenomic datasets. The non-ancient taxa (<a href="#fig-authentication-fig5" class="quarto-xref">Figure&nbsp;<span>12.8</span></a>) report significance values below 2, in contrast to the ancient taxa (<a href="#fig-authentication-fig5" class="quarto-xref">Figure&nbsp;<span>12.8</span></a>) which reach a significance of 20. A relaxed significance threshold (Zfit &gt; 2) and a minimum of 100 reads increase the accuracy of damage estimates to 90% of the dataset <span class="citation" data-cites="Michelsen2022">(<a href="#ref-Michelsen2022" role="doc-biblioref">Michelsen et al. 2022</a>)</span>.</p>
<p>We also observe how the oldest samples (Cave-100 and Cave-102) which are 100 and 102 thousand years BP, show the highest amount of damage of all the metagenomes. While Pitch-6 and Cave-22 samples, which are 6 and 22 thousand years old and thus younger have almost similar levels of damage.</p>
</section>
<section id="ancient-metagenomic-dataset" class="level3" data-number="12.5.3">
<h3 data-number="12.5.3" class="anchored" data-anchor-id="ancient-metagenomic-dataset"><span class="header-section-number">12.5.3</span> Ancient metagenomic dataset</h3>
<p>In this section, we will use 6 metagenomic libraries downsampled with eukaryotes reads from the study by <span class="citation" data-cites="zampirolo2024tracing">(<a href="#ref-zampirolo2024tracing" role="doc-biblioref">Zampirolo et al. 2024</a>)</span> (<a href="#fig-authentication-fig6" class="quarto-xref">Figure&nbsp;<span>12.9</span></a>). The libraries originate from sediment samples of the Velký Mamut’ák rock shelter located in Northern Bohemia (Czech Republic) and covering the period between the Late Neolithic (~6100-5300 cal. BP) to more recent times (800 cal BP).</p>
<div id="fig-authentication-fig6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/paper.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.9: Screenshot of the study of the source dataset by <span class="citation" data-cites="zampirolo2024tracing">(<a href="#ref-zampirolo2024tracing" role="doc-biblioref">Zampirolo et al. 2024</a>)</span>
</figcaption>
</figure>
</div>
</section>
<section id="ancient-metagenomics-with-metadmg-cpp-the-workflow" class="level3" data-number="12.5.4">
<h3 data-number="12.5.4" class="anchored" data-anchor-id="ancient-metagenomics-with-metadmg-cpp-the-workflow"><span class="header-section-number">12.5.4</span> Ancient metagenomics with metaDMG-cpp: the workflow</h3>
<p>This section will cover the metaDMG analysis which involve taxonomic classification of the reads starting from sorted SAM files, the damage estimation and compilation of the final metaDMG output.</p>
<p>To begin, we can find raw SAM files used as input to <code>metaDMG</code> we will use for the exercise are stored in the <code>metadmg</code> folder.</p>
<p>We also need the taxonomy files, which are in the folder <code>metadmg/small_taxonomy/</code>, these include <code>names.dmp</code>, <code>nodes.dmp</code> and <code>small_accession2taxid.txt.gz</code>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>metaDMG</strong> is currently under development and it is therefore important to keep it updated. The best documentation is currently found in the –help function.</p>
</div>
</div>
<p>metaDMG is installed in the conda environment ’authentication`. If not activated yet, we run</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> activate authentication </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before you continue, make sure you’re within the <code>authentication/</code> directory!</p>
</div>
</div>
<p>First we will run <code>metaDMG-cpp lca</code> to get the mismatch matrix file <code>bdamage.gz</code> that we need to estimate the dfit.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> lca <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--acc2tax</span> metadmg/small_taxonomy/small_accession2taxid.txt.gz <span class="at">--sim_score_low</span> 0.95 <span class="at">--sim_score_high</span> 1.0 <span class="at">--how_many</span> 30 <span class="at">--weight_type</span> 1 <span class="at">--threads</span> 12 <span class="at">--bam</span> metadmg/VM-3_800.merged.sort.bam <span class="at">--out_prefix</span> metadmg/VM-3_800.merged.bam</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> lca <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--acc2tax</span> metadmg/small_taxonomy/small_accession2taxid.txt.gz <span class="at">--sim_score_low</span> 0.95 <span class="at">--sim_score_high</span> 1.0 <span class="at">--how_many</span> 30 <span class="at">--weight_type</span> 1 <span class="at">--threads</span> 12 <span class="at">--bam</span> metadmg/VM-11_3000.merged.sort.bam <span class="at">--out_prefix</span> metadmg/VM-11_3000.merged.bam</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> lca <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--acc2tax</span> metadmg/small_taxonomy/small_accession2taxid.txt.gz <span class="at">--sim_score_low</span> 0.95 <span class="at">--sim_score_high</span> 1.0 <span class="at">--how_many</span> 30 <span class="at">--weight_type</span> 1 <span class="at">--threads</span> 12 <span class="at">--bam</span> metadmg/VM-14_3900.merged.sort.bam <span class="at">--out_prefix</span> metadmg/VM-14_3900.merged.bam </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> lca <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--acc2tax</span> metadmg/small_taxonomy/small_accession2taxid.txt.gz <span class="at">--sim_score_low</span> 0.95 <span class="at">--sim_score_high</span> 1.0 <span class="at">--how_many</span> 30 <span class="at">--weight_type</span> 1 <span class="at">--threads</span> 12 <span class="at">--bam</span> metadmg/VM-15_4100.merged.sort.bam <span class="at">--out_prefix</span> metadmg/VM-15_4100.merged.bam </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> lca <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--acc2tax</span> metadmg/small_taxonomy/small_accession2taxid.txt.gz <span class="at">--sim_score_low</span> 0.95 <span class="at">--sim_score_high</span> 1.0 <span class="at">--how_many</span> 30 <span class="at">--weight_type</span> 1 <span class="at">--threads</span> 12 <span class="at">--bam</span> metadmg/VM-17_5300.merged.sort.bam <span class="at">--out_prefix</span> metadmg/VM-17_5300.merged.bam </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> lca <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--acc2tax</span> metadmg/small_taxonomy/small_accession2taxid.txt.gz <span class="at">--sim_score_low</span> 0.95 <span class="at">--sim_score_high</span> 1.0 <span class="at">--how_many</span> 30 <span class="at">--weight_type</span> 1 <span class="at">--threads</span> 12 <span class="at">--bam</span> metadmg/VM-19_6100.merged.sort.bam <span class="at">--out_prefix</span> metadmg/VM-19_6100.merged.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We use the file generated from the previous command (<code>bdamage.gz</code>), containing the misincorporation matrix to calculate the deamination pattern. We use metaDMG-cpp dfit function to obtain a quick computation of a beta-binomial model.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit metadmg/VM-3_800.merged.bam.bdamage.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span>  metadmg/small_taxonomy/nodes.dmp <span class="at">--showfits</span> 2  <span class="at">--lib</span> ds <span class="at">--out</span> metadmg/VM-3_800.merged.bam </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit metadmg/VM-11_3000.merged.bam.bdamage.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span>  metadmg/small_taxonomy/nodes.dmp <span class="at">--showfits</span> 2  <span class="at">--lib</span> ds <span class="at">--out</span> metadmg/VM-11_3000.merged.bam </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit metadmg/VM-14_3900.merged.bam.bdamage.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span>  metadmg/small_taxonomy/nodes.dmp <span class="at">--showfits</span> 2  <span class="at">--lib</span> ds <span class="at">--out</span> metadmg/VM-14_3900.merged.bam</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit metadmg/VM-15_4100.merged.bam.bdamage.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span>  metadmg/small_taxonomy/nodes.dmp <span class="at">--showfits</span> 2  <span class="at">--lib</span> ds <span class="at">--out</span> metadmg/VM-15_4100.merged.bam </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit metadmg/VM-17_5300.merged.bam.bdamage.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span>  metadmg/small_taxonomy/nodes.dmp <span class="at">--showfits</span> 2  <span class="at">--lib</span> ds <span class="at">--out</span> metadmg/VM-17_5300.merged.bam </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit metadmg/VM-19_6100.merged.bam.bdamage.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span>  metadmg/small_taxonomy/nodes.dmp <span class="at">--showfits</span> 2  <span class="at">--lib</span> ds <span class="at">--out</span> metadmg/VM-19_6100.merged.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled" title="Example only - do not run!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example only - do not run!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>metaDMG-cpp dfit</code> function also allows for the computation of a binomial model, which includes additional statistics (such as bootstrap estimated parameters). For the exercise, we only run the quick statistics, but we provide an example of the codes for full stat:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> dfit metadmg/VM-11_3000.merged.bam.bdamage.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span>  metadmg/small_taxonomy/nodes.dmp <span class="at">--showfits</span> 2 <span class="at">--nopt</span> 10 <span class="at">--nbootstrap</span> 20 <span class="at">--doboot</span> 1 <span class="at">--seed</span> 1234  <span class="at">--lib</span> ds <span class="at">--out</span> metadmg/VM-11_3000.merged.bam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We run the <code>metaDMG-cpp aggregate</code> function to merge the statistics from the previous two steps and obtain a file for each sample.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> aggregate metadmg/VM-3_800.merged.bam.bdamage.gz <span class="at">-lcastat</span> metadmg/VM-3_800.merged.bam.stat.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--dfit</span> metadmg/VM-3_800.merged.bam.dfit.gz <span class="at">--out</span> metadmg/VM-3_aggregated_results</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> aggregate metadmg/VM-11_3000.merged.bam.bdamage.gz <span class="at">-lcastat</span> metadmg/VM-11_3000.merged.bam.stat.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--dfit</span> metadmg/VM-11_3000.merged.bam.dfit.gz <span class="at">--out</span> metadmg/VM-11_aggregated_results</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> aggregate metadmg/VM-14_3900.merged.bam.bdamage.gz <span class="at">-lcastat</span> metadmg/VM-14_3900.merged.bam.stat.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--dfit</span> metadmg/VM-14_3900.merged.bam.dfit.gz <span class="at">--out</span> metadmg/VM-14_aggregated_results</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> aggregate metadmg/VM-15_4100.merged.bam.bdamage.gz <span class="at">-lcastat</span> metadmg/VM-15_4100.merged.bam.stat.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--dfit</span> metadmg/VM-15_4100.merged.bam.dfit.gz <span class="at">--out</span> metadmg/VM-15_aggregated_results</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> aggregate metadmg/VM-17_5300.merged.bam.bdamage.gz <span class="at">-lcastat</span> metadmg/VM-17_5300.merged.bam.stat.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--dfit</span> metadmg/VM-17_5300.merged.bam.dfit.gz <span class="at">--out</span> metadmg/VM-17_aggregated_results</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="ex">metaDMG-cpp</span> aggregate metadmg/VM-19_6100.merged.bam.bdamage.gz <span class="at">-lcastat</span> metadmg/VM-19_6100.merged.bam.stat.gz <span class="at">--names</span> metadmg/small_taxonomy/names.dmp <span class="at">--nodes</span> metadmg/small_taxonomy/nodes.dmp <span class="at">--dfit</span> metadmg/VM-19_6100.merged.bam.dfit.gz <span class="at">--out</span> metadmg/VM-19_aggregated_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the last step we merge the header and the filenames in a unique tab-separated file (TSV).</p>
<p>We first change into the <code>metadmg/</code> results directory, and unzip the output files</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> metadmg</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gunzip</span> <span class="pp">*</span>_aggregated_results.stat.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then we extract the header and we concatenate the content of all the output files in a unique TSV file.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define header for final output table</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="va">header_file</span><span class="op">=</span><span class="st">"VM-11_aggregated_results.stat"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the header</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="va">header</span><span class="op">=</span><span class="va">$(</span><span class="fu">head</span> <span class="at">-n</span> 1 <span class="st">"</span><span class="va">$header_file</span><span class="st">"</span><span class="va">)</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the output file</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="va">output_file</span><span class="op">=</span><span class="st">"concatenated_metaDMGfinal.tsv"</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the header to the concatenated file</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"filename\t</span><span class="va">$header</span><span class="st">"</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$output_file</span><span class="st">"</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> file <span class="kw">in</span> VM-11_aggregated_results.stat <span class="dt">\</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        VM-14_aggregated_results.stat <span class="dt">\</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>            VM-15_aggregated_results.stat <span class="dt">\</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>            VM-17_aggregated_results.stat <span class="dt">\</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>            VM-19_aggregated_results.stat <span class="dt">\</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>            VM-3_aggregated_results.stat</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="st">"</span><span class="va">$file</span><span class="st">"</span> <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">line</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="at">-e</span> <span class="st">"</span><span class="va">$file</span><span class="st">\t</span><span class="va">$line</span><span class="st">"</span> <span class="op">&gt;&gt;</span> <span class="st">"</span><span class="va">$output_file</span><span class="st">"</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="investigating-the-final-output-with-r" class="level3" data-number="12.5.5">
<h3 data-number="12.5.5" class="anchored" data-anchor-id="investigating-the-final-output-with-r"><span class="header-section-number">12.5.5</span> Investigating the final output with R</h3>
<p>We first visualise our metaDMG output manually by navigating to the folder <code>metadmg/</code> with your file browser and clicking on “Open folder”. Open the TSV file <code>concatenated_metaDMGfinal.tsv</code> in a spreadsheet manner and inspect the files.</p>
<p>We will now investigate the TSV table produced by metaDMG to authenticate damage patterns, visualise the relationship between the damage and the significance, and the degree of damage through depth and time.</p>
<p>R packages for this exercise are located in the same conda environment <code>authentication</code>.</p>
<p>While still in the <code>authentication/metadmg/</code> folder, we load R by running <code>R</code> in your terminal</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We load the libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="amplitude-of-damage-vs-significance" class="level3" data-number="12.5.6">
<h3 data-number="12.5.6" class="anchored" data-anchor-id="amplitude-of-damage-vs-significance"><span class="header-section-number">12.5.6</span> Amplitude of damage vs Significance</h3>
<p>We provide an R script to investigate the main statistics.</p>
<p>Here we visualise the amplitude of damage (A) and its significance (Zfit), for the full dataset but filtering it to a minimum of 100 reads and at the genus level (<a href="#fig-authentication-fig7" class="quarto-xref">Figure&nbsp;<span>12.10</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#We load our metaDMG output data (TSV file) and the metadata with information on the age of each sample.</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"concatenated_metaDMGfinal.tsv"</span>,  <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Rename sample column</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)[<span class="fu">colnames</span>(df) <span class="sc">==</span> <span class="st">'filename'</span>] <span class="ot">&lt;-</span> <span class="st">'sample'</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Modify sample name with short names</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sample[df<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"VM-11_aggregated_results.stat"</span>] <span class="ot">&lt;-</span> <span class="st">"VM-11"</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sample[df<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"VM-14_aggregated_results.stat"</span>] <span class="ot">&lt;-</span> <span class="st">"VM-14"</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sample[df<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"VM-15_aggregated_results.stat"</span>] <span class="ot">&lt;-</span> <span class="st">"VM-15"</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sample[df<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"VM-17_aggregated_results.stat"</span>] <span class="ot">&lt;-</span> <span class="st">"VM-17"</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sample[df<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"VM-19_aggregated_results.stat"</span>] <span class="ot">&lt;-</span> <span class="st">"VM-19"</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sample[df<span class="sc">$</span>sample <span class="sc">==</span> <span class="st">"VM-3_aggregated_results.stat"</span>] <span class="ot">&lt;-</span> <span class="st">"VM-3"</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Import the metadata with dates BP</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>depth_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span> (<span class="st">"figures/depth_data.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span> (depth_data)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Merge context_data and depth_data with dataframe (adding new column for dates BP)</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>new <span class="ot">&lt;-</span> depth_data<span class="sc">$</span>Date_BP[<span class="fu">match</span>(df<span class="sc">$</span>sample, depth_data<span class="sc">$</span>Sample_ID)]</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)[<span class="fu">names</span>(df) <span class="sc">==</span> <span class="st">'new'</span>] <span class="ot">&lt;-</span> <span class="st">'Date_BP'</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Date_BP columns to factors (categorical variable) </span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Date_BP <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>Date_BP)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Subset dataset animal and plants at the genus level</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nreads <span class="sc">&gt;</span> <span class="dv">100</span>, <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">bgenus</span><span class="sc">\\</span><span class="st">b"</span>, rank), <span class="fu">grepl</span>(<span class="st">"Metazoa"</span>, taxa_path) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">"Viridiplant"</span>, taxa_path))</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding factor column for Kingdom</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> dt1 <span class="sc">%&gt;%</span> </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Kingdom =</span>   <span class="co"># creating our new column</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">"Viridiplant"</span>, taxa_path) <span class="sc">~</span> <span class="st">"Viridiplantae"</span>,</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">grepl</span>(<span class="st">"Metazoa"</span>,taxa_path) <span class="sc">~</span> <span class="st">"Metazoa"</span>))</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting  amplitude of damage vs its significance and saving as pdf file</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">"figures/p1.pdf"</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dt1, <span class="fu">aes</span>(<span class="at">y=</span>A, <span class="at">x=</span>Zfit)) <span class="sc">+</span> </span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>nreads, <span class="at">col=</span>Kingdom)) <span class="sc">+</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#8B1A1A"</span>, <span class="st">"#458B00"</span>))<span class="sc">+</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"significance"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"damage"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-authentication-fig7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/p1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.10: Amplitude of damage (A) vs significance (Zfit) for animals and plants.
</figcaption>
</figure>
</div>
</section>
<section id="amplitude-of-damage-and-mean-fragment-length-through-time" class="level3" data-number="12.5.7">
<h3 data-number="12.5.7" class="anchored" data-anchor-id="amplitude-of-damage-and-mean-fragment-length-through-time"><span class="header-section-number">12.5.7</span> Amplitude of damage and mean fragment length through time</h3>
<p>Here we visualise the amplitude of damage (A) and the mean length of the fragments (mean_rlen) by date (BP) for the filtered dataset with a minimum of 100 reads and at the genus level (<a href="#fig-authentication-fig8" class="quarto-xref">Figure&nbsp;<span>12.11</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting damage (A) by period (dates BP)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>p2a<span class="ot">&lt;-</span> dt1 <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date_BP =</span> <span class="fu">fct_relevel</span>(Date_BP,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"6100"</span>,<span class="st">"5300"</span>,<span class="st">"4100"</span>,<span class="st">"3900"</span>,<span class="st">"3000"</span>, <span class="st">"800"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>A, <span class="at">y=</span>Date_BP))<span class="sc">+</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>A, <span class="at">y=</span>Date_BP, <span class="at">fill =</span> sample))<span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> sample), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.20</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.20</span>, <span class="at">by =</span> <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>p2a</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting mean length (mean_rlen) by period (dates BP)</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>p2b<span class="ot">&lt;-</span> dt1 <span class="sc">%&gt;%</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date_BP =</span> <span class="fu">fct_relevel</span>(Date_BP,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"6100"</span>,<span class="st">"5300"</span>,<span class="st">"4100"</span>,<span class="st">"3900"</span>,<span class="st">"3000"</span>, <span class="st">"800"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mean_rlen, <span class="at">y=</span>Date_BP))<span class="sc">+</span> </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mean_rlen, <span class="at">y=</span>Date_BP, <span class="at">fill =</span> sample)) <span class="sc">+</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> sample), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">80</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">30</span>, <span class="dv">80</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>p2b</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Combining the plots and saving as pdf file</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">"figures/p2.pdf"</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">grid.arrange</span>(p2a, p2b,</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-authentication-fig8" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fig8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/p2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fig8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.11: Amplitude of damage (A) and mean fragment length (mean_rlen) through time.
</figcaption>
</figure>
</div>
<section id="deamination-patterns-1" class="level4" data-number="12.5.7.1">
<h4 data-number="12.5.7.1" class="anchored" data-anchor-id="deamination-patterns-1"><span class="header-section-number">12.5.7.1</span> Deamination patterns</h4>
<p>We run the damage plot to visualise the deamination patterns along forward and reverse strands, and we save the results per each taxon detected in the samples.</p>
<p>We will use the function <code>get_dmg_decay_fit</code> to visualise damage pattern (<a href="#fig-authentication-fagusovisdmg" class="quarto-xref">Figure&nbsp;<span>12.12</span></a>). The function is saved in <code>metadmg/script/</code>, so we only need to run the following command to recall it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"script/get_dmg_decay_fit.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But if you are curious and want to know how it works, here is the function itself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>get_dmg_decay_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">orient =</span> <span class="st">"fwd"</span>, <span class="at">pos =</span> <span class="dv">30</span>, <span class="at">p_breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>), <span class="at">y_max =</span> <span class="fl">0.7</span>, <span class="at">y_min =</span> <span class="sc">-</span><span class="fl">0.01</span>) {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  df_dx_fwd <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(taxid, name, label, <span class="fu">starts_with</span>(<span class="st">"fwdx"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"fwdxConf"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"Dx_fwd"</span>, <span class="fu">c</span>(<span class="sc">-</span>taxid, <span class="sc">-</span>name, <span class="sc">-</span>label)) <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">gsub</span>(<span class="st">"fwdx"</span>, <span class="st">""</span>, type)) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  df_dx_rev <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(taxid, name, label, <span class="fu">starts_with</span>(<span class="st">"bwdx"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"bwdxConf"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"Dx_rev"</span>, <span class="fu">c</span>(<span class="sc">-</span>taxid, <span class="sc">-</span>name, <span class="sc">-</span>label)) <span class="sc">%&gt;%</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">gsub</span>(<span class="st">"bwdx"</span>, <span class="st">""</span>, type)) <span class="sc">%&gt;%</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  df_dx_std_fwd <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(taxid, name, label, <span class="fu">starts_with</span>(<span class="st">"fwdxConf"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"Dx_std_fwd"</span>, <span class="fu">c</span>(<span class="sc">-</span>taxid, <span class="sc">-</span>name, <span class="sc">-</span>label)) <span class="sc">%&gt;%</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">gsub</span>(<span class="st">"fwdxConf"</span>, <span class="st">""</span>, type)) <span class="sc">%&gt;%</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  df_dx_std_rev <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(taxid, name, label, <span class="fu">starts_with</span>(<span class="st">"bwdxConf"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"Dx_std_rev"</span>, <span class="fu">c</span>(<span class="sc">-</span>taxid, <span class="sc">-</span>name, <span class="sc">-</span>label)) <span class="sc">%&gt;%</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">gsub</span>(<span class="st">"bwdxConf"</span>, <span class="st">""</span>, type)) <span class="sc">%&gt;%</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>  df_fit_fwd <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(taxid, name, label, <span class="fu">starts_with</span>(<span class="st">"fwf"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"f_fwd"</span>, <span class="fu">c</span>(<span class="sc">-</span>taxid, <span class="sc">-</span>name, <span class="sc">-</span>label)) <span class="sc">%&gt;%</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">gsub</span>(<span class="st">"fwf"</span>, <span class="st">""</span>, type)) <span class="sc">%&gt;%</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>  df_fit_rev <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(taxid, name, label, <span class="fu">starts_with</span>(<span class="st">"bwf"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"f_rev"</span>, <span class="fu">c</span>(<span class="sc">-</span>taxid, <span class="sc">-</span>name, <span class="sc">-</span>label)) <span class="sc">%&gt;%</span></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">gsub</span>(<span class="st">"bwf"</span>, <span class="st">""</span>, type)) <span class="sc">%&gt;%</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>type)</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> df_dx_fwd <span class="sc">%&gt;%</span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(df_dx_rev, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"taxid"</span>, <span class="st">"name"</span>, <span class="st">"label"</span>, <span class="st">"x"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(df_dx_std_fwd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"taxid"</span>, <span class="st">"name"</span>, <span class="st">"label"</span>, <span class="st">"x"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(df_dx_std_rev, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"taxid"</span>, <span class="st">"name"</span>, <span class="st">"label"</span>, <span class="st">"x"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(df_fit_fwd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"taxid"</span>, <span class="st">"name"</span>, <span class="st">"label"</span>, <span class="st">"x"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(df_fit_rev, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"taxid"</span>, <span class="st">"name"</span>, <span class="st">"label"</span>, <span class="st">"x"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(x)) <span class="sc">%&gt;%</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(x <span class="sc">&lt;=</span> pos) <span class="sc">%&gt;%</span></span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Dx_fwd_min =</span> Dx_fwd <span class="sc">-</span> Dx_std_fwd,</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">Dx_fwd_max =</span> Dx_fwd <span class="sc">+</span> Dx_std_fwd,</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">Dx_rev_min =</span> Dx_rev <span class="sc">-</span> Dx_std_rev,</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>           <span class="at">Dx_rev_max =</span> Dx_rev <span class="sc">+</span> Dx_std_rev)</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>  fwd_max <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">as.character</span>(x)) <span class="sc">%&gt;%</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">val =</span> <span class="fu">mean</span>(Dx_std_fwd) <span class="sc">+</span> <span class="fu">sd</span>(Dx_std_fwd)) <span class="sc">%&gt;%</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(val) <span class="sc">%&gt;%</span></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>  fwd_min <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">as.character</span>(x)) <span class="sc">%&gt;%</span></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">val =</span> <span class="fu">mean</span>(Dx_std_fwd) <span class="sc">-</span> <span class="fu">sd</span>(Dx_std_fwd)) <span class="sc">%&gt;%</span></span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(val) <span class="sc">%&gt;%</span></span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">min</span>()</span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>  rev_max <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">as.character</span>(x)) <span class="sc">%&gt;%</span></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">val =</span> <span class="fu">mean</span>(Dx_std_rev) <span class="sc">+</span> <span class="fu">sd</span>(Dx_std_rev)) <span class="sc">%&gt;%</span></span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(val) <span class="sc">%&gt;%</span></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>()</span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>  rev_min <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="fu">as.character</span>(x)) <span class="sc">%&gt;%</span></span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">val =</span> <span class="fu">mean</span>(Dx_std_rev) <span class="sc">-</span> <span class="fu">sd</span>(Dx_std_rev)) <span class="sc">%&gt;%</span></span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(val) <span class="sc">%&gt;%</span></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">min</span>()</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (orient <span class="sc">==</span> <span class="st">"fwd"</span>) {</span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(x, <span class="at">ymin =</span> Dx_fwd_min, <span class="at">ymax =</span> Dx_fwd_max, <span class="at">group =</span> <span class="fu">interaction</span>(name, taxid)), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">"darkcyan"</span>) <span class="sc">+</span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(x, Dx_fwd, <span class="at">group =</span> <span class="fu">interaction</span>(name, taxid)), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(x, f_fwd), <span class="at">alpha =</span> .<span class="dv">50</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_test</span>() <span class="sc">+</span></span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">"Position"</span>) <span class="sc">+</span></span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(y_min, y_max), <span class="at">breaks =</span> p_breaks) <span class="sc">+</span></span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>label, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(x, <span class="at">ymin =</span> Dx_rev_min, <span class="at">ymax =</span> Dx_rev_max, <span class="at">group =</span> <span class="fu">interaction</span>(name, taxid)), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_path</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(x, Dx_rev, <span class="at">group =</span> <span class="fu">interaction</span>(name, taxid)), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(x, f_rev), <span class="at">alpha =</span> .<span class="dv">50</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_test</span>() <span class="sc">+</span></span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">"Position"</span>) <span class="sc">+</span></span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">trans =</span> <span class="st">"reverse"</span>) <span class="sc">+</span></span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(y_min, y_max), <span class="at">position =</span> <span class="st">"right"</span>, <span class="at">breaks =</span> p_breaks) <span class="sc">+</span></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>label, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We generate the damage plots as seen in <a href="#fig-authentication-fagusovisdmg" class="quarto-xref">Figure&nbsp;<span>12.12</span></a> using the function <code>get-damage</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting filtering theshold for ancient reads</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>minDMG <span class="ot">=</span> <span class="fl">0.02</span> <span class="co"># filter criteria, plot only taxa above set value</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>zfit <span class="ot">=</span> <span class="dv">2</span> <span class="co"># minimum significance, the higher the better, 2 would mean that we estimante the damage with 95% confidence. </span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>MinLength <span class="ot">=</span> <span class="dv">35</span> <span class="co"># minimum mean readlength, while we set a hard filter initially while trimming, we would like the mean readlength to be 35 or higher. </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>reads <span class="ot">=</span> <span class="dv">200</span> <span class="co"># number of reads required depends on the amount of damage and the significance</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting only animals and plants, at the genus level, number of reads &gt; 200.</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(A <span class="sc">&gt;</span> minDMG, nreads <span class="sc">&gt;=</span> reads, mean_rlen <span class="sc">&gt;=</span> MinLength, Zfit  <span class="sc">&gt;</span> zfit, <span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">bgenus</span><span class="sc">\\</span><span class="st">b"</span>, rank), <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"Bacteria"</span>,taxa_path))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#deamination plot with facet wrap per each taxon in a sample</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>tax_g_list <span class="ot">&lt;-</span> <span class="fu">unique</span>(dt2<span class="sc">$</span>name)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>nrank <span class="ot">&lt;-</span> <span class="st">"rank"</span> <span class="co"># Replace with the actual rank column name</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> tax_g_list </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(tax_g_list, <span class="cf">function</span>(X, nrank) {</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  sel_tax <span class="ot">&lt;-</span> dt2 <span class="sc">%&gt;%</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">label =</span> sample) <span class="sc">%&gt;%</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(name <span class="sc">==</span> X) <span class="sc">%&gt;%</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(rank <span class="sc">==</span> rank) <span class="sc">%&gt;%</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, label) <span class="sc">%&gt;%</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(name)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(sel_tax) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    n_readsa <span class="ot">&lt;-</span> dt2 <span class="sc">%&gt;%</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">inner_join</span>(sel_tax) <span class="sc">%&gt;%</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(rank <span class="sc">==</span> rank) <span class="sc">%&gt;%</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(nreads) <span class="sc">%&gt;%</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>()</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_dmg_decay_fit</span>(<span class="at">df =</span> dt2 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label =</span> sample) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(sel_tax) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rank <span class="sc">==</span> rank), <span class="at">orient =</span> <span class="st">"fwd"</span>, <span class="at">y_max =</span> <span class="fl">0.70</span>) <span class="sc">+</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(X, <span class="st">" nreads="</span>, n_readsa, <span class="st">" Forward"</span>)),</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">get_dmg_decay_fit</span>(<span class="at">df =</span> dt2 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">label =</span> sample)  <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(sel_tax) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rank <span class="sc">==</span> rank), <span class="at">orient =</span> <span class="st">"rev"</span>, <span class="at">y_max =</span> <span class="fl">0.70</span>) <span class="sc">+</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(X, <span class="st">" nreads="</span>, n_readsa, <span class="st">" Reverse"</span>))</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">align =</span> <span class="st">"hv"</span>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"figures/"</span>, X, <span class="st">"-dmg.pdf"</span>), <span class="at">plot =</span> <span class="fu">last_plot</span>(), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">4</span>)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-authentication-fagusovisdmg" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-authentication-fagusovisdmg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="assets/images/chapters/authentication/Fagus_Ovis-dmg.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-authentication-fagusovisdmg-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.12: Deamination patterns for sheep (<em>Ovis</em>) and beech (<em>Fagus</em>) reads.
</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Once finished examining the plots you can quit R</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Press 'n' when asked if you want to save your workspace image.</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quit()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can manually navigate to the folder <code>metadmg/figures/</code> And click “Open folder” You can double-click on the pdf files to visualise them.</p>
</div>
</div>
</section>
</section>
</section>
<section id="optional-clean-up" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="optional-clean-up"><span class="header-section-number">12.6</span> (Optional) clean-up</h2>
<p>Let’s clean up our working directory by removing all the data and output from this chapter.</p>
<p>The command below will remove the <code>/&lt;PATH&gt;/&lt;TO&gt;/authentication</code> <em>as well as all of its contents</em>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pro Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Always be VERY careful when using <code>rm -r</code>. Check 3x that the path you are specifying is exactly what you want to delete and nothing more before pressing ENTER!</p>
</div>
</div>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> /<span class="op">&lt;</span>PATH<span class="op">&gt;</span>/<span class="op">&lt;</span>TO<span class="op">&gt;</span>/authentication<span class="pp">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once deleted we can move elsewhere (e.g.&nbsp;<code>cd ~</code>).</p>
<p>We can also get out of the <code>conda</code> environment with.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> deactivate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then to delete the conda environment.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> remove <span class="at">--name</span> authentication <span class="at">--all</span> <span class="at">-y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="summary" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="summary"><span class="header-section-number">12.7</span> Summary</h2>
<p>In addition, we:</p>
<ul>
<li>Processed bam files with metaDMG to generate taxonomic profiles and damage estimates from a metagenomic dataset</li>
<li>Investigated some primary statistics of the metaDMG output using R:
<ul>
<li>Deamination patterns,</li>
<li>The amplitude of damage vs significance,</li>
<li>The amplitude of damage and</li>
<li>Mean fragment length through time.</li>
</ul></li>
</ul>
</section>
<section id="acknowledgments" class="level2" data-number="12.8">
<h2 data-number="12.8" class="anchored" data-anchor-id="acknowledgments"><span class="header-section-number">12.8</span> Acknowledgments</h2>
<p>We thank Mikkel Winther Pedersen and Antonio Fernandez Guerra for their contribution to the development of the <code>metaDMG</code> section. G.Z. would like to thank the European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation programme (Grant Agreement No.&nbsp;856488, project SEACHANGE).</p>
</section>
<section id="recommended-reading" class="level2" data-number="12.9">
<h2 data-number="12.9" class="anchored" data-anchor-id="recommended-reading"><span class="header-section-number">12.9</span> Recommended Reading</h2>
<ol type="1">
<li><p>Clio Der Sarkissian, Irina M. Velsko, Anna K. Fotakis, Åshild J. Vågene, Alexander Hübner, and James A. Fellows Yates, Ancient Metagenomic Studies: Considerations for the Wider Scientific Community, mSystems 2021 Volume 6 Issue 6 e01315-21.</p></li>
<li><p>Warinner C, Herbig A, Mann A, Fellows Yates JA, Weiß CL, Burbano HA, Orlando L, Krause J. A Robust Framework for Microbial Archaeology. Annu Rev Genomics Hum Genet. 2017 Aug 31;18:321-356. doi: 10.1146/annurev-genom-091416-035526. Epub 2017 Apr 26. PMID: 28460196; PMCID: PMC5581243.</p></li>
<li><p>Orlando, L., Allaby, R., Skoglund, P. et al.&nbsp;Ancient DNA analysis. Nat Rev Methods Primers 1, 14 (2021). https://doi.org/10.1038/s43586-020-00011-0</p></li>
</ol>
</section>
<section id="resources" class="level2" data-number="12.10">
<h2 data-number="12.10" class="anchored" data-anchor-id="resources"><span class="header-section-number">12.10</span> Resources</h2>
<ol type="1">
<li><p><strong>KrakenUniq</strong>: Breitwieser, F. P., Baker, D. N., &amp; Salzberg, S. L. (2018). KrakenUniq: confident and fast metagenomics classification using unique k-mer counts. Genome Biology, vol.&nbsp;19(1), p.&nbsp;1–10. http://www.ec.gc.ca/education/default.asp?lang=En&amp;n=44E5E9BB-1</p></li>
<li><p><strong>Samtools</strong>: Heng Li, Bob Handsaker, Alec Wysoker, Tim Fennell, Jue Ruan, Nils Homer, Gabor Marth, Goncalo Abecasis, Richard Durbin, 1000 Genome Project Data Processing Subgroup, The Sequence Alignment/Map format and SAMtools, Bioinformatics, Volume 25, Issue 16, 15 August 2009, Pages 2078–2079, https://doi.org/10.1093/bioinformatics/btp352</p></li>
<li><p><strong>PMDtools</strong>: Skoglund P, Northoff BH, Shunkov MV, Derevianko AP, Pääbo S, Krause J, Jakobsson M. Separating endogenous ancient DNA from modern day contamination in a Siberian Neandertal. Proc Natl Acad Sci U S A. 2014 Feb 11;111(6):2229-34. doi: 10.1073/pnas.1318934111. Epub 2014 Jan 27. PMID: 24469802; PMCID: PMC3926038.</p></li>
<li><p><strong>pyDamage</strong>: Borry M, Hübner A, Rohrlach AB, Warinner C. PyDamage: automated ancient damage identification and estimation for contigs in ancient DNA de novo assembly. PeerJ. 2021 Jul 27;9:e11845. doi: 10.7717/peerj.11845. PMID: 34395085; PMCID: PMC8323603.</p></li>
<li><p><strong>metaDMG-cpp</strong>: https://github.com/metaDMG-dev/metaDMG-cpp</p></li>
<li><p><strong>ngsLCA</strong>: Wang, Y., Korneliussen, T. S., Holman, L. E., Manica, A., &amp; Pedersen, M. W. (2022). ngs LCA—A toolkit for fast and flexible lowest common ancestor inference and taxonomic profiling of metagenomic data. Methods in Ecology and Evolution, 13(12), 2699-2708. (https://github.com/miwipe/ngsLCA)</p></li>
</ol>
</section>
<section id="references" class="level2" data-number="12.11">
<h2 data-number="12.11" class="anchored" data-anchor-id="references"><span class="header-section-number">12.11</span> References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Michelsen2022" class="csl-entry" role="listitem">
Michelsen, Christian, Mikkel Winther Pedersen, Antonio Fernandez-Guerra, Lei Zhao, Troels C. Petersen, and Thorfinn Sand Korneliussen. 2022. <span>“metaDMG – a Fast and Accurate Ancient DNA Damage Toolkit for Metagenomic Data,”</span> December. <a href="https://doi.org/10.1101/2022.12.06.519264">https://doi.org/10.1101/2022.12.06.519264</a>.
</div>
<div id="ref-Pochon2022-hj" class="csl-entry" role="listitem">
Pochon, Zoé, Nora Bergfeldt, Emrah Kırdök, Mário Vicente, Thijessen Naidoo, Tom van der Valk, N Ezgi Altınışık, et al. 2022. <span>“<span class="nocase">aMeta</span>: An Accurate and Memory-Efficient Ancient Metagenomic Profiling Workflow.”</span> <em>bioRxiv</em>. <a href="https://doi.org/10.1101/2022.10.03.510579">https://doi.org/10.1101/2022.10.03.510579</a>.
</div>
<div id="ref-Wang2022-fr" class="csl-entry" role="listitem">
Wang, Yucheng, Thorfinn Sand Korneliussen, Luke E Holman, Andrea Manica, and Mikkel Winther Pedersen. 2022. <span>“<em>Ngs</em>LCA—a Toolkit for Fast and Flexible Lowest Common Ancestor Inference and Taxonomic Profiling of Metagenomic Data.”</span> <em>Methods in Ecology and Evolution</em> 13 (12): 2699–2708. <a href="https://doi.org/10.1111/2041-210x.14006">https://doi.org/10.1111/2041-210x.14006</a>.
</div>
<div id="ref-zampirolo2024tracing" class="csl-entry" role="listitem">
Zampirolo, Giulia, Luke E Holman, Rikai Sawafuji, Michaela Ptáková, Lenka Kovačiková, Petr Šı́da, Petr Pokornỳ, Mikkel Winther Pedersen, and Matthew Walls. 2024. <span>“Tracing Early Pastoralism in Central Europe Using Sedimentary Ancient DNA.”</span> <em>Current Biology</em> 34 (20): 4650–61. <a href="https://doi.org/10.1016/j.cub.2024.08.047">https://doi.org/10.1016/j.cub.2024.08.047</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/spaam-community\.github\.org\/intro-to-ancient-metagenomics-book");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./denovo-assembly.html" class="pagination-link" aria-label="_De novo_ Genome Assembly">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><em>De novo</em> Genome Assembly</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./contamination.html" class="pagination-link" aria-label="Contamination">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Contamination</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2024 SPAAM Community &amp; Authors with ❤️. Available under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a>. Source material <a href="https://github.com/SPAAM-community/intro-to-ancient-metagenomics-book">here</a>.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>